using Cisl;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Data.SqlClient;
using System.Data;
using System.Transactions;
using System.Configuration;
using System.Security.Cryptography;
using System.Text;
using System.IO;

namespace ConnectRechargeWebsite.Model
{
    public class ConnectRechargech
    {
        ///////////////    Credit Recharge parameters    ////////////
        String URL = ConfigurationManager.AppSettings["URL"];
        String ClientId = ConfigurationManager.AppSettings["ClientId"];
        String ClienKey = ConfigurationManager.AppSettings["ClientKey"];
        ///////////////////////////////////////////////////////////
        private string conn = System.Configuration.ConfigurationManager.ConnectionStrings["con"].ConnectionString;
        private SqlDataAdapter da;
        private SqlConnection con;
        private SqlConnection con1;
        private SqlConnection con2;
        private SqlCommand cmd;
        private SqlCommand cmd1;
        private SqlDataReader dr;
        private SqlDataReader dr1;
        public DataTable dt;
        public string network;
        public string phone;
        public string city;
        public string state;
        public string country;
        public string nationality;
        public string bankname;
        public string accountno;
        public string email;
        public string ResponseMsg;
        public string password;
        public int credit;
        public string ORTrail;
        public double points;
        public string note;
        public double RechargeAmount;
        public string UserId;
        public string emailConfCODE;
        public string partnername;
        public string refCode;
        private int day = DateTime.Now.Day;
        private int month = DateTime.Now.Month;
        private int year = DateTime.Now.Year;
        public int dd;
        public int mm;
        public int yy;
        private string currentdate = DateTime.Now.ToShortDateString();
        private double currentdayofweek = DateTime.Now.Day;
        public string gender;
        public string Referrer;
        public string currency;
        public double balance;
        public double amount;
        public int phoneRechargeAmount;
        public int dataRechargeAmount;
        public string status;
        public string PID;
        public string placementid;
        public string UserIdsKeep;
        public string username;
        public string program;
        public string placementname;
        public string referralID;
        public string referralname;
        public string useridname;
        public string programID;
        public double AssignedSN;
        public int AutoAccounts = 2;
        public string route;
        public int clientBalance;
        public double GRC;
        public string RechargeType;
        public int logicalpins;
        public int TotalRechargeCost;
        public string nickname;
        public string idearnings;
        public double CBPV;
        public string Award;
        public int APVLevel;
        public string depositorname;
        public string depositoremail;
        public string depositoramount;
        public string depositorpaymode;
        public string depositbank = "";
        public string tellerno = "";
        public string remarks = "";
        public string depositorpaydate;
        public int withdrawalAmount;
        public string withdrawType;
        public string depositorCRStatus;
        public string PIN = "";
        private Network net;
        private String msisdn;
        public double trailAmount;
        public int MaxSN = 0;
        public int MinSN;
        public int previous = 0;
        public int next = 0;
        private int TrackSN;
        public string tranid;
        public int PayStackAmount;
        public string citizenRegistration = "0";
        public string IDCard;
        public string IDNo;
        public int vendor;
        private string check4; private string check3; private string check2; private string check1;

        public double Pay0;
        public double PayAmt0;
        public double Pay1;
        public double PayAmt1;
        public double Pay2;
        public double PayAmt2;
        public double Pay3;
        public double PayAmt3;
        public double Pay4;
        public double PayAmt4;
        public double Pay5;
        public double PayAmt5;
        public double Pay6;
        public double PayAmt6;
        public double Pay7;
        public double PayAmt7;
        public double Pay8;
        public double PayAmt8;
        public double Pay9;
        public double PayAmt9;
        public double Pay10;
        public double PayAmt10;
        public double Pay11;
        public double PayAmt11;
        public double Pay12;
        public double PayAmt12;
        public double Pay13;
        public double PayAmt13;
        public double Pay14;
        public double PayAmt14;
        public double Pay15;
        public double PayAmt15;
        public double Pay16;
        public double PayAmt16;
        public double Pay17;
        public double PayAmt17;
        public double Pay18;
        public double PayAmt18;
        public double Pay19;
        public double PayAmt19;
        public double Pay20;
        public double PayAmt20;
        public double Pay21;
        public double PayAmt21;
        public double Pay22;
        public double PayAmt22;
        public double Pay23;
        public double PayAmt23;
        public double Pay24;
        public double PayAmt24;
        public double Pay25;
        public double PayAmt25;
        public double Pay26;
        public double PayAmt26;
        public double Pay27;
        public double PayAmt27;
        public double Pay28;
        public double PayAmt28;
        public double Pay29;
        public double PayAmt29;
        public double Pay30;
        public double PayAmt30;
        public double Pay31;
        public double PayAmt31;
        public double Pay32;
        public double PayAmt32;
        public double Pay33;
        public double PayAmt33;

        /// <summary>
        /// ConnectRecharge Classes executes 3 major Sub class functions
        /// OpenRecharge - For Normal instant recharge functions by non-paid registered members who just want to recharge and go
        /// ConnectCitizens - For Registered Members who pay to sign up and get so many benefits
        /// ConnectAmbassadors - These are online/offline partners promoting, using and selling both services above to the public
        /// </summary>


        #region Cryptography
        public string Encrypt(string clearText)
        {
            string EncryptionKey = "NVP2SMKYI72518";
            byte[] clearBytes = Encoding.Unicode.GetBytes(clearText);
            using (Aes encryptor = Aes.Create())
            {
                Rfc2898DeriveBytes pdb = new Rfc2898DeriveBytes(EncryptionKey, new byte[] { 0x49, 0x76, 0x61, 0x6e, 0x20, 0x4d, 0x65, 0x64, 0x76, 0x65, 0x64, 0x65, 0x76 });
                encryptor.Key = pdb.GetBytes(32);
                encryptor.IV = pdb.GetBytes(16);
                using (MemoryStream ms = new MemoryStream())
                {
                    using (CryptoStream cs = new CryptoStream(ms, encryptor.CreateEncryptor(), CryptoStreamMode.Write))
                    {
                        cs.Write(clearBytes, 0, clearBytes.Length);
                        cs.Close();
                    }
                    clearText = Convert.ToBase64String(ms.ToArray());
                }
            }
            return clearText;
        }

        public string Decrypt(string cipherText)
        {
            string EncryptionKey = "NVP2SMKYI72518";
            byte[] cipherBytes = Convert.FromBase64String(cipherText);
            using (Aes encryptor = Aes.Create())
            {
                Rfc2898DeriveBytes pdb = new Rfc2898DeriveBytes(EncryptionKey, new byte[] { 0x49, 0x76, 0x61, 0x6e, 0x20, 0x4d, 0x65, 0x64, 0x76, 0x65, 0x64, 0x65, 0x76 });
                encryptor.Key = pdb.GetBytes(32);
                encryptor.IV = pdb.GetBytes(16);
                using (MemoryStream ms = new MemoryStream())
                {
                    using (CryptoStream cs = new CryptoStream(ms, encryptor.CreateDecryptor(), CryptoStreamMode.Write))
                    {
                        cs.Write(cipherBytes, 0, cipherBytes.Length);
                        cs.Close();
                    }
                    cipherText = Encoding.Unicode.GetString(ms.ToArray());
                }
            }
            return cipherText;
        }
        #endregion




        #region OPEN_RECHARGE
        //Signs up a new user to the OpenRecharge section of the software, only email and/or phone number is required to complete this
        public void OpenRechargeSignUp()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select email from CROpenSignUp where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            ResponseMsg = "Email already exists.";
                        }
                        else
                        {
                            dr.Dispose();
                            using (cmd = new SqlCommand("Insert into CROpenSignUp(email,password,ref,status,emailcode) values (@email,@password,@ref,@status,@emailcode)", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@password", password);
                                cmd.Parameters.AddWithValue("@ref", refCode);
                                cmd.Parameters.AddWithValue("@status", "1");
                                cmd.Parameters.AddWithValue("@emailcode", "0");
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Success!";
                            }
                        }
                    }
                }
            }
        }

        public void OpenRechargeForgotPassword()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("Select email from cropensignup where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            int yourRandomEmailString = 6; //maximum: 32 
                            string emailconfcode = Guid.NewGuid().ToString("N").Substring(0, yourRandomEmailString);

                            dr.Dispose();
                            using(cmd = new SqlCommand("Update cropensignup set emailcode=@emailcode where email=@email", con))
                            {
                                cmd.Parameters.AddWithValue("@emailcode", emailconfcode);
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = emailconfcode;
                            }
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }

        public void OpenRechargeUpdatePassword()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select emailcode from cropensignup where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            string emailcode = dr.GetValue(0).ToString();
                            if (emailConfCODE == emailcode)
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Update cropensignup set password=@password where email=@email", con))
                                {
                                    cmd.Parameters.AddWithValue("@password", password);
                                    cmd.Parameters.AddWithValue("@email", email);
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Password change was successful!";
                                }
                            }
                            else
                            {
                                ResponseMsg = "Invalid Code!";
                            }
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }

        //Logs in a verified user to carry out recharge functions
        public void OpenRechargeLogin()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select email,password,ref from CROpenSignUp where email=@email and password=@password", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    password = Encrypt(password);
                    cmd.Parameters.AddWithValue("@password", password);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            string EMAIL = dr.GetValue(0).ToString();
                            string PASSWORD = dr.GetValue(1).ToString();
                            referralID = dr.GetValue(2).ToString();
                            if (EMAIL == email && PASSWORD == password)
                            {
                                ResponseMsg = "1";
                            }
                            else
                            {
                                ResponseMsg = "0";
                            }
                        }
                    }
                }
            }
        }

        //Send OpenRecharge Deposit Info
        public void SendPayNotification()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();

                if (tellerno != "" && tellerno != "None")
                {
                    using (cmd = new SqlCommand("Select tellerno from crpaydetails where tellerno=@tellerno and bankname=@bankname", con))
                    {
                        cmd.Parameters.AddWithValue("@tellerno", tellerno);
                        cmd.Parameters.AddWithValue("@bankname", depositbank);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read() && !dr.IsDBNull(0))
                            {
                                ResponseMsg = "Teller No. is invalid or has been previously submitted.";
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Insert into crpaydetails(depositorname,email,amount,paymode,bankname,tellerno,paydate,crstatus,confirmed,confirmedby,confirmedDate) values (@depositorname,@email,@amount,@paymode,@bankname,@tellerno,@paydate,@crstatus,@confirmed,@confirmedby,@confirmedDate)", con))
                                {
                                    cmd.Parameters.AddWithValue("@depositorname", depositorname);
                                    cmd.Parameters.AddWithValue("@email", depositoremail);
                                    cmd.Parameters.AddWithValue("@amount", depositoramount);
                                    cmd.Parameters.AddWithValue("@paymode", depositorpaymode);
                                    cmd.Parameters.AddWithValue("@bankname", depositbank);
                                    cmd.Parameters.AddWithValue("@tellerno", tellerno);
                                    cmd.Parameters.AddWithValue("@paydate", depositorpaydate);
                                    cmd.Parameters.AddWithValue("@crstatus", depositorCRStatus);
                                    cmd.Parameters.AddWithValue("@confirmed", "No");
                                    cmd.Parameters.AddWithValue("@confirmedBy", "0");
                                    cmd.Parameters.AddWithValue("@confirmedDate", "0");
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Success!";
                                }
                            }
                        }
                    }
                }
                else
                {
                    //dr.Dispose();
                    using (cmd = new SqlCommand("Insert into crpaydetails(depositorname,email,amount,paymode,bankname,tellerno,paydate,crstatus,confirmed,confirmedby,confirmedDate) values (@depositorname,@email,@amount,@paymode,@bankname,@tellerno,@paydate,@crstatus,@confirmed,@confirmedby,@confirmedDate)", con))
                    {
                        cmd.Parameters.AddWithValue("@depositorname", depositorname);
                        cmd.Parameters.AddWithValue("@email", depositoremail);
                        cmd.Parameters.AddWithValue("@amount", depositoramount);
                        cmd.Parameters.AddWithValue("@paymode", depositorpaymode);
                        cmd.Parameters.AddWithValue("@bankname", depositbank);
                        cmd.Parameters.AddWithValue("@tellerno", tellerno);
                        cmd.Parameters.AddWithValue("@paydate", depositorpaydate);
                        cmd.Parameters.AddWithValue("@crstatus", depositorCRStatus);
                        cmd.Parameters.AddWithValue("@confirmed", "No");
                        cmd.Parameters.AddWithValue("@confirmedBy", "0");
                        cmd.Parameters.AddWithValue("@confirmedDate", "0");
                        cmd.ExecuteNonQuery();
                        ResponseMsg = "Success!";
                    }
                }
            }
        }

        //Get Data Trail
        public DataTable OpenRechargeGetDataTrail()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();

                if (MaxSN == 0)
                {
                    using (cmd = new SqlCommand("Select Max(SN) from CROpenTrail where email=@email", con))
                    {
                        cmd.Parameters.AddWithValue("@email", username);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                int result = int.Parse(dr.GetValue(0).ToString());
                                if (result > 1)
                                {
                                    dr.Dispose();
                                    using (cmd = new SqlCommand("Select Max(SN),Min(SN) from CROpenTrail where email=@email", con))
                                    {
                                        cmd.Parameters.AddWithValue("@email", username);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                MaxSN = int.Parse(dr.GetValue(0).ToString());
                                                MinSN = int.Parse(dr.GetValue(0).ToString());
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    MaxSN = 1;
                                    MinSN = 1;
                                }
                            }
                        }
                    }
                }
                else
                {
                    if (next == 1)
                    {
                        MinSN = MaxSN + 1;
                        MaxSN = MaxSN + 20;
                    }
                    else if(previous == 1)
                    {                        
                        MaxSN = MaxSN - 19;
                    }
                }

               // dr.Dispose();
                using (cmd = new SqlCommand("Select Note as Transactions,Date as Tran_Date from CROpenTrail where email=@email and sn<=@Maxsn and sn>=@Minsn ORDER BY [SN] DESC", con))
                {
                    cmd.Parameters.AddWithValue("@email", username);
                    if (MaxSN < 20)
                    {
                        cmd.Parameters.AddWithValue("@Maxsn", MaxSN);
                        cmd.Parameters.AddWithValue("@Minsn", MinSN);
                    }
                    else
                    {
                        cmd.Parameters.AddWithValue("@Maxsn", MaxSN);
                        cmd.Parameters.AddWithValue("@Minsn", MaxSN - 19);
                    }
                    using (SqlDataAdapter sda = new SqlDataAdapter())
                    {
                        cmd.Connection = con;
                        sda.SelectCommand = cmd;
                        using (dt = new DataTable())
                        {
                            sda.Fill(dt);
                            return dt;
                        }
                    }
                }        
            }
        }

        //Use to Add/top-up credit balance
        public void OpenRechargeAddCredit()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select email,credit from CROpenCredit where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    //cmd.Parameters.AddWithValue("@credit", credit);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            int OLDcredit = int.Parse(dr.GetValue(0).ToString());
                            credit = credit + OLDcredit;
                            //update the existing credit for this email
                            dr.Dispose();
                            using (cmd = new SqlCommand("Update CROpenCredit set credit=@credit where email=@email", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@credit", credit);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Success! New balance is " + credit;
                            }
                        }
                        else
                        {
                            dr.Dispose();
                            using (cmd = new SqlCommand("Insert into CROpenCredit(email,credit) values (@email,@credit)", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@credit", credit);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Success! New balance is " + credit;
                            }
                        }
                    }
                }
            }
        }

        //Retrieves the Credit wallet balance for an OpenRecharge User
        public void OpenRechargeCheckCreditBalance()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select credit from CROpenCredit where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            credit = int.Parse(dr.GetValue(0).ToString());
                        }
                    }
                }
            }
        }

        //Retrieves the openRechargePoints(ORP) wallet balance for an OpenRecharge User
        public void OpenRechargeCheckPointsBalance()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            points = double.Parse(dr.GetValue(0).ToString());
                        }
                    }
                }
            }
        }

        //Use to Add Open Recharge Points Bonus
        public void OpenRechargeAddPoints()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select email,points from CROpenPoints where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    //cmd.Parameters.AddWithValue("@credit", credit);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            int OLDpoints = int.Parse(dr.GetValue(0).ToString());
                            double pointsPercent = 0.01 * RechargeAmount;
                            points = pointsPercent + OLDpoints;
                            //update the existing credit for this email
                            dr.Dispose();
                            using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@points", points);
                                cmd.ExecuteNonQuery();


                                double ORC = 0.005 * RechargeAmount;
                                using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read())
                                        {
                                            UserId = dr.GetValue(0).ToString();
                                            useridname = dr.GetValue(1).ToString();

                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                cmd.Parameters.AddWithValue("@status", "0");
                                                cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                cmd.Parameters.AddWithValue("@programid", UserId);
                                                cmd.ExecuteNonQuery();

                                                ResponseMsg = "Success! New balance Points is " + points;
                                            }
                                        }
                                    }
                                }
                            }                   
                        }
                        else
                        {
                            dr.Dispose();
                            double pointsPercent = 0.01 * RechargeAmount;
                            points = pointsPercent;
                            using (cmd = new SqlCommand("Insert into CROpenPoints(email,points) values (@email,@points)", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@credit", points);
                                cmd.ExecuteNonQuery();

                                double ORC = 0.005 * RechargeAmount;
                                using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read())
                                        {
                                            UserId = dr.GetValue(0).ToString();
                                            useridname = dr.GetValue(1).ToString();

                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                cmd.Parameters.AddWithValue("@status", "0");
                                                cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                cmd.Parameters.AddWithValue("@programid", UserId);
                                                cmd.ExecuteNonQuery();

                                                ResponseMsg = "Success! New balance Points is " + points;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        //Use to subtract/reduce/use OR points bonus to recharge phone lines
        public void OpenRechargeRemovePoints()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("select points from CROpenPoints where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            double points = double.Parse(dr.GetValue(0).ToString());
                            if(points >= credit)
                            {//credit is the amount to be recharged that will be paid for with OR Points
                                
                                //Trigger the AirtimeClient function here

                                //Update the OpenRecharge Points balance
                                double balance = points - credit;
                                dr.Dispose();
                                using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                {
                                    cmd.Parameters.AddWithValue("@email", email);
                                    cmd.Parameters.AddWithValue("@points", points);
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Done!";
                                }

                            }
                        }
                    }
                }
            }
        }

        //Check uniqueness of Transaction ID Generated for PayStack - OpenRecharge
        public void checkTranID()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select tranid from cropenpaystacktrack where tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            ResponseMsg = "1";
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }        
        }

        //Open Recharge PayStack Track
        public void OpenRechargePayStackTrack()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("Select tranid from cropenpaystacktrack where email=@email and tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            ResponseMsg = "Transaction already exists.";
                        }
                        else
                        {
                            dr.Dispose();
                            using (cmd = new SqlCommand("Insert into cropenpaystacktrack (email,tranid,amount,date,status) values (@email,@tranid,@amount,@date,@status)", con))
                            {
                                cmd.Parameters.AddWithValue("@email", email);
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToString());
                                cmd.Parameters.AddWithValue("@status", 0);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Saved!";
                            }
                        }
                    }
                }
            }
        }

        //Fund Wallet via PayStack
        public void OpenRechargeFundWallet()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select credit from cropencredit where email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@email", email);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            int amount = int.Parse(dr.GetValue(0).ToString());
                            int newAmount = amount + PayStackAmount;

                            dr.Dispose();
                            
                            using (cmd = new SqlCommand("Select status from cropenpaystacktrack where tranid=@tranid and amount=@amount", con))
                            {
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                using(dr = cmd.ExecuteReader())
                                {
                                    if(dr.Read())
                                    {
                                        int getStatus = int.Parse(dr.GetValue(0).ToString());
                                        if(getStatus == 0)
                                        {
                                            using (cmd = new SqlCommand("Update cropenpaystacktrack set status=@status where tranid=@tranid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@status", 1);
                                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                                dr.Dispose();
                                                cmd.ExecuteNonQuery();

                                                using (cmd = new SqlCommand("Update cropencredit set credit=@credit where email=@email", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@credit", newAmount);
                                                    cmd.Parameters.AddWithValue("@email", email);
                                                    cmd.ExecuteNonQuery();
                                                    ResponseMsg = "Wallet Funded!";
                                                }
                                            }
                                        }
                                        else if(getStatus == 1)
                                        {
                                            ResponseMsg = "Invalid Transaction ID: Has been previously used!";
                                        }
                                    }
                                    else
                                    {
                                        ResponseMsg = "Invalid Transaction ID.";
                                    }
                                }
                            }
                        }
                        else
                        {
                            //int amount = int.Parse(dr.GetValue(0).ToString());
                            int newAmount = 0 + PayStackAmount;

                            dr.Dispose();

                            using (cmd = new SqlCommand("Select status from cropenpaystacktrack where tranid=@tranid and amount=@amount", con))
                            {
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                using (dr = cmd.ExecuteReader())
                                {
                                    if (dr.Read())
                                    {
                                        int getStatus = int.Parse(dr.GetValue(0).ToString());
                                        if (getStatus == 0)
                                        {
                                            using (cmd = new SqlCommand("Update cropenpaystacktrack set status=@status where tranid=@tranid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@status", 1);
                                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                                dr.Dispose();
                                                cmd.ExecuteNonQuery();

                                                using (cmd = new SqlCommand("Insert into cropencredit(email,credit) values (@email,@credit)", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@email", email);
                                                    cmd.Parameters.AddWithValue("@credit", newAmount);
                                                    cmd.ExecuteNonQuery();
                                                    ResponseMsg = "Wallet Funded!";
                                                }
                                            }
                                        }
                                        else if (getStatus == 1)
                                        {
                                            ResponseMsg = "Invalid Transaction ID: Has been previously used!";
                                        }
                                    }
                                    else
                                    {
                                        ResponseMsg = "Invalid Transaction ID.";
                                    }
                                }
                            }
                        }
                    }
                }           
            }
        }

        //Tracks every transaction executed via OpenRecharge in detailed records
        public void OpenRechargeTrail()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Insert into CROpenTrail (Note,Date,Email) values (@note,@date,@email)", con))
                {
                    cmd.Parameters.AddWithValue("@note", note + " - Tracked on " + DateTime.Now.ToString());
                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToString());
                    cmd.Parameters.AddWithValue("@email", email);
                    cmd.ExecuteNonQuery();
                }
            }
        } 
        #endregion

        #region RechargeAirtime_for_All_Networks
        public void RechargeAirtime()
        {
            AirtimeClient airtime = new AirtimeClient(URL, ClientId, ClienKey);
            //Network net;
            //String msisdn;

            if (RechargeType != "Logical")
            {
                net = AirtimeClient.Parse(network);
                msisdn = phone;
            }
            int Rechargeamount = phoneRechargeAmount;
            try
            {//clientBalance - Connect Recharge Registered users balance
                if (clientBalance >= Rechargeamount)
                {
                    BalanceResult balance = airtime.Balance();
                    int CreditBalance = balance.balance;
                    CreditBalance = CreditBalance / 100;
                    //CreditBalance - MNO balance
                    //Rechargeamount is the same as phoneRechargeAmount
                    if (CreditBalance >= TotalRechargeCost)
                    {
                        //Code to recharge a phone number
                        String xref = Guid.NewGuid().ToString("N");
                        String getResponseMessage = "";
                        using (con = new SqlConnection(conn))
                        {
                            con.Open();
                            if (RechargeType == "Logical")
                            {
                                if (logicalpins > 1)
                                {
                                    int i = 0;
                                    for (i = 0; i <= logicalpins - 1; i++)
                                    {
                                        AllocateSingleResult allocate = airtime.AllocateSingle(phoneRechargeAmount, "AIRTIME", "ConnectRecharge", xref);
                                        getResponseMessage = allocate.message;

                                        PIN = allocate.pin;

                                        using (cmd = new SqlCommand("Insert into CRRechargeLogicalTracker(userid,route,network,amount,phonenumber,serialid,pin,unit,fee,type,xref,message,datecreated,dd,mm,yy) values (@userid,@route,@network,@amount,@phonenumber,@serialid,@pin,@unit,@fee,@type,@xref,@message,@datecreated,@dd,@mm,@yy)", con))
                                        {//serialid,pin,unit,fee,type
                                            if (email == "" || email == null)
                                            {
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                            }
                                            else
                                            {
                                                cmd.Parameters.AddWithValue("@userid", email);
                                            }
                                            cmd.Parameters.AddWithValue("@route", route);//OR - Open Recharge,ORP - Openrecharge points,CC - ConnectCitizens
                                            cmd.Parameters.AddWithValue("@network", "NET");
                                            cmd.Parameters.AddWithValue("@amount", phoneRechargeAmount);
                                            cmd.Parameters.AddWithValue("@phonenumber", 0);
                                            cmd.Parameters.AddWithValue("@serialid", allocate.serial);
                                            cmd.Parameters.AddWithValue("@pin", allocate.pin);
                                            cmd.Parameters.AddWithValue("@unit", allocate.unit);
                                            cmd.Parameters.AddWithValue("@fee", allocate.fee);
                                            cmd.Parameters.AddWithValue("@type", allocate.type);
                                            cmd.Parameters.AddWithValue("@xref", allocate.xref);
                                            cmd.Parameters.AddWithValue("@message", allocate.message);
                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToString());
                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                            cmd.ExecuteNonQuery();
                                        }
                                    }
                                }
                                else
                                {
                                    AllocateSingleResult allocate = airtime.AllocateSingle(phoneRechargeAmount, "AIRTIME", "ConnectRecharge", xref);
                                    getResponseMessage = allocate.message;

                                    PIN = allocate.pin;

                                    using (cmd = new SqlCommand("Insert into CRRechargeLogicalTracker(userid,route,network,amount,phonenumber,serialid,pin,unit,fee,type,xref,message,datecreated,dd,mm,yy) values (@userid,@route,@network,@amount,@phonenumber,@serialid,@pin,@unit,@fee,@type,@xref,@message,@datecreated,@dd,@mm,@yy)", con))
                                    {//serialid,pin,unit,fee,type
                                        if (email == "" || email == null)
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                        }
                                        else
                                        {
                                            cmd.Parameters.AddWithValue("@userid", email);
                                        }
                                        cmd.Parameters.AddWithValue("@route", route);//OR - Open Recharge,ORP - Openrecharge points,CC - ConnectCitizens
                                        cmd.Parameters.AddWithValue("@network", "NET");
                                        cmd.Parameters.AddWithValue("@amount", phoneRechargeAmount);
                                        cmd.Parameters.AddWithValue("@phonenumber", 0);
                                        cmd.Parameters.AddWithValue("@serialid", allocate.serial);
                                        cmd.Parameters.AddWithValue("@pin", allocate.pin);
                                        cmd.Parameters.AddWithValue("@unit", allocate.unit);
                                        cmd.Parameters.AddWithValue("@fee", allocate.fee);
                                        cmd.Parameters.AddWithValue("@type", allocate.type);
                                        cmd.Parameters.AddWithValue("@xref", allocate.xref);
                                        cmd.Parameters.AddWithValue("@message", allocate.message);
                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToString());
                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                        cmd.ExecuteNonQuery();
                                    }
                                }
                                    

                                if (getResponseMessage != "")
                                {
                                    //Update the balance
                                    //Get new balance after recharge
                                    double balanceAfterRecharge = clientBalance - TotalRechargeCost;
                                    if (route == "OR")
                                    {
                                        using (cmd = new SqlCommand("Select credit from CROpenCredit where email=@email", con))
                                        {
                                            cmd.Parameters.AddWithValue("@email", email);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                    double getNewCredit = getPreviousCredit - TotalRechargeCost;

                                                    //Effect the Update codes now
                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("Update CROpenCredit set credit=@credit where email=@email", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@credit", getNewCredit);
                                                        cmd.Parameters.AddWithValue("@email", email);
                                                        cmd.ExecuteNonQuery();

                                                        //Add the 1% commission for personal recharge as ORP - Open Recharge Points
                                                        double ORP = 0.01 * TotalRechargeCost;
                                                        using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@email", email);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    double getPreviousPoints = double.Parse(dr.GetValue(0).ToString());
                                                                    double newPoints = getPreviousPoints + ORP;

                                                                    //Update the ORP
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@email", email);
                                                                        cmd.Parameters.AddWithValue("@points", newPoints);
                                                                        cmd.ExecuteNonQuery();

                                                                        //Add the referrals 0.005% commission too
                                                                        double ORC = 0.005 * TotalRechargeCost;
                                                                        using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    UserId = dr.GetValue(0).ToString();
                                                                                    useridname = dr.GetValue(1).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                        cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                        cmd.ExecuteNonQuery();


                                                                                        ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                        trailAmount = newPoints;
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                    trailAmount = newPoints;
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    //Update the ORP
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into CROpenPoints (points,email) values (@points,@email)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@email", email);
                                                                        cmd.Parameters.AddWithValue("@points", ORP);
                                                                        cmd.ExecuteNonQuery();


                                                                        double ORC = 0.005 * phoneRechargeAmount;
                                                                        using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    UserId = dr.GetValue(0).ToString();
                                                                                    useridname = dr.GetValue(1).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                        cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                        cmd.ExecuteNonQuery();

                                                                                        ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                        trailAmount = ORP;
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                    trailAmount = ORP;
                                                                                }
                                                                            }
                                                                        }
                                                                        //ResponseMsg = "SUCCESS!";
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }//End of OpenRecharge //Beginning of Open Recharge Points
                                    else if (route == "ORP")
                                    {
                                        using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                        {
                                            cmd.Parameters.AddWithValue("@email", email);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                    double getNewCredit = getPreviousCredit - phoneRechargeAmount;

                                                    //Effect the Update codes now
                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@points", getNewCredit);
                                                        cmd.Parameters.AddWithValue("@email", email);
                                                        cmd.ExecuteNonQuery();

                                                        //Add nothing since this is the Points given previously as bonus

                                                        ResponseMsg = "Success! New balance Points is " + getNewCredit;
                                                        trailAmount = getNewCredit;
                                                    }
                                                }
                                            }
                                        }
                                    }//End of OpenRecharge Points // Beginning Of ConnectCitizens & ConnectAmbassadors
                                    else if (route == "CC")
                                    {
                                        using (cmd = new SqlCommand("Select SUM(amountdue),SUM(deductions) from CRCitizensEarnings where userid=@userid", con))
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read() && !dr.IsDBNull(0))
                                                {
                                                    double amountdue = double.Parse(dr.GetValue(0).ToString());
                                                    double deductions = double.Parse(dr.GetValue(1).ToString());
                                                    double currbalance = amountdue - deductions;
                                                    int balancecredit = int.Parse(currbalance.ToString());

                                                    if (balancecredit > phoneRechargeAmount)
                                                    {
                                                        double newdeduction = phoneRechargeAmount;

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    useridname = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }
                                                        //Enter phone Recharge Deduction into Earnings
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Airtime PIN Recharge Cost");
                                                            cmd.Parameters.AddWithValue("@amountdue", 0);
                                                            cmd.Parameters.AddWithValue("@deductions", newdeduction);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Airtime PIN Recharge Cost");
                                                            cmd.Parameters.AddWithValue("@programid", UserId);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();
                                                            ResponseMsg = "SUCCESS!";
                                                        }

                                                        //Add the commissions
                                                        //2% for self recharge commission
                                                        dr.Dispose();
                                                        double SRC = 0.02 * phoneRechargeAmount;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Self Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@amountdue", SRC);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Self Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@programid", UserId);
                                                            cmd.ExecuteNonQuery();
                                                            ResponseMsg = "SUCCESS!";
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralname = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }
                                                        //0.4% upline recharge commission
                                                        double RRC = 0.004 * phoneRechargeAmount;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                            cmd.Parameters.AddWithValue("@rank", "Referral Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@amountdue", RRC);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Referral Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@programid", " ");
                                                            cmd.ExecuteNonQuery();
                                                            ResponseMsg = "SUCCESS!";
                                                        }

                                                        //TARC computation where applicable
                                                        #region TARC Computation
                                                        //Level 1
                                                        string RefLevel2 = "";
                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    RefLevel2 = dr.GetValue(0).ToString();

                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                    {//userid,tarc,dd,mm,yy
                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                        cmd.ExecuteNonQuery();
                                                                        ResponseMsg = "SUCCESS!";
                                                                    }

                                                                    //Level 2
                                                                    string RefLevel3 = "";
                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                        using (dr = cmd.ExecuteReader())
                                                                        {
                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                            {
                                                                                RefLevel3 = dr.GetValue(0).ToString();

                                                                                dr.Dispose();
                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                {//userid,tarc,dd,mm,yy
                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                    cmd.ExecuteNonQuery();
                                                                                    ResponseMsg = "SUCCESS!";
                                                                                }

                                                                                //Level 3
                                                                                string RefLevel4 = "";
                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                {
                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                    using (dr = cmd.ExecuteReader())
                                                                                    {
                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                        {
                                                                                            RefLevel4 = dr.GetValue(0).ToString();

                                                                                            dr.Dispose();
                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                cmd.ExecuteNonQuery();
                                                                                                ResponseMsg = "SUCCESS!";
                                                                                            }

                                                                                            //Level 4
                                                                                            string RefLevel5 = "";
                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                            {
                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                {
                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                    {
                                                                                                        RefLevel5 = dr.GetValue(0).ToString();

                                                                                                        dr.Dispose();
                                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                        {//userid,tarc,dd,mm,yy
                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                            cmd.ExecuteNonQuery();
                                                                                                            ResponseMsg = "SUCCESS!";
                                                                                                        }

                                                                                                        //Level 5
                                                                                                        string RefLevel6 = "";
                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                        {
                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                            {
                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                {
                                                                                                                    RefLevel6 = dr.GetValue(0).ToString();

                                                                                                                    dr.Dispose();
                                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                                    }

                                                                                                                    //Level 6
                                                                                                                    string RefLevel7 = "";
                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                    {
                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                        {
                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                            {
                                                                                                                                RefLevel7 = dr.GetValue(0).ToString();

                                                                                                                                dr.Dispose();
                                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                                }

                                                                                                                                //Level 7
                                                                                                                                string RefLevel8 = "";
                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                {
                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                    {
                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                        {
                                                                                                                                            RefLevel8 = dr.GetValue(0).ToString();

                                                                                                                                            dr.Dispose();
                                                                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                                ResponseMsg = "SUCCESS!";
                                                                                                                                            }

                                                                                                                                            //Level 8
                                                                                                                                            string RefLevel9 = "";
                                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                            {
                                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                                {
                                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                    {
                                                                                                                                                        RefLevel9 = dr.GetValue(0).ToString();

                                                                                                                                                        dr.Dispose();
                                                                                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                        {//userid,tarc,dd,mm,yy
                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                                            ResponseMsg = "SUCCESS!";
                                                                                                                                                        }

                                                                                                                                                        //Level 9
                                                                                                                                                        string RefLevel10 = "";
                                                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                        {
                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                                                            {
                                                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                {
                                                                                                                                                                    RefLevel10 = dr.GetValue(0).ToString();

                                                                                                                                                                    dr.Dispose();
                                                                                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                                                                                    }

                                                                                                                                                                    //Level 10
                                                                                                                                                                    string RefLevel11 = "";
                                                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                                    {
                                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                                                        {
                                                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                            {
                                                                                                                                                                                RefLevel11 = dr.GetValue(0).ToString();

                                                                                                                                                                                dr.Dispose();
                                                                                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel11);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        } 
                                                        #endregion
                                                    }
                                                    else
                                                    {
                                                        ResponseMsg = "Insufficient Credit Balance!";
                                                    }
                                                }
                                                else
                                                {
                                                    ResponseMsg = "Error!";
                                                }
                                            }
                                        }

                                    }// End Of ConnectCitizens & ConnectAmbassadors
                                    else
                                    {
                                        ResponseMsg = "Transaction failed, please try again later.";
                                    }
                                }
                            }
                            else if (RechargeType == "VTU")
                            {
                                AirtimeResult credit = airtime.Credit(net, msisdn, Rechargeamount, xref);
                                getResponseMessage = credit.message;

                                using (cmd = new SqlCommand("Insert into CRRechargeTracker(userid,route,network,amount,phonenumber,transactionid,xref,message,datecreated,dd,mm,yy) values (@userid,@route,@network,@amount,@phonenumber,@transactionid,@xref,@message,@datecreated,@dd,@mm,@yy)", con))
                                {
                                    if (email == "" || email == null)
                                    {
                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                    }
                                    else
                                    {
                                        cmd.Parameters.AddWithValue("@userid", email);
                                    }
                                    cmd.Parameters.AddWithValue("@route", route);//OR - Open Recharge,ORP - Openrecharge points,CC - ConnectCitizens
                                    cmd.Parameters.AddWithValue("@network", network);
                                    cmd.Parameters.AddWithValue("@amount", phoneRechargeAmount);
                                    cmd.Parameters.AddWithValue("@phonenumber", phone);
                                    if (credit.id == null)
                                    {
                                        cmd.Parameters.AddWithValue("@transactionid", credit.xref);
                                    }
                                    else
                                    {
                                        cmd.Parameters.AddWithValue("@transactionid", credit.id);
                                    }
                                    cmd.Parameters.AddWithValue("@xref", credit.xref);
                                    cmd.Parameters.AddWithValue("@message", credit.message);
                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToString());
                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                    cmd.ExecuteNonQuery();
                                }

                                if (getResponseMessage == "SUCCESS")
                                {
                                    //Update the balance
                                    //Get new balance after recharge
                                    int balanceAfterRecharge = clientBalance - phoneRechargeAmount;
                                    if (route == "OR")
                                    {
                                        using (cmd = new SqlCommand("Select credit from CROpenCredit where email=@email", con))
                                        {
                                            cmd.Parameters.AddWithValue("@email", email);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                    double getNewCredit = getPreviousCredit - phoneRechargeAmount;

                                                    //Effect the Update codes now
                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("Update CROpenCredit set credit=@credit where email=@email", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@credit", getNewCredit);
                                                        cmd.Parameters.AddWithValue("@email", email);
                                                        cmd.ExecuteNonQuery();

                                                        //Add the 2% commission for personal recharge as ORP - Open Recharge Points
                                                        double ORP = 0.02 * phoneRechargeAmount;
                                                        using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@email", email);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    double getPreviousPoints = double.Parse(dr.GetValue(0).ToString());
                                                                    double newPoints = getPreviousPoints + ORP;

                                                                    //Update the ORP
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@email", email);
                                                                        cmd.Parameters.AddWithValue("@points", newPoints);
                                                                        cmd.ExecuteNonQuery();


                                                                        double ORC = 0.005 * phoneRechargeAmount;
                                                                        using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    UserId = dr.GetValue(0).ToString();
                                                                                    useridname = dr.GetValue(1).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                        cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                        cmd.ExecuteNonQuery();

                                                                                        ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                        trailAmount = newPoints;
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                    trailAmount = newPoints;
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    //int getPreviousPoints = int.Parse(dr.GetValue(0).ToString());
                                                                    //double newPoints = getPreviousPoints + ORP;

                                                                    //Update the ORP
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into CROpenPoints (points,email) values (@points,@email)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@email", email);
                                                                        cmd.Parameters.AddWithValue("@points", ORP);
                                                                        cmd.ExecuteNonQuery();


                                                                        double ORC = 0.005 * phoneRechargeAmount;
                                                                        using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    UserId = dr.GetValue(0).ToString();
                                                                                    useridname = dr.GetValue(1).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@rank", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                        cmd.Parameters.AddWithValue("@reason", "Open Recharge Airtime Commission for " + email);
                                                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                        cmd.ExecuteNonQuery();

                                                                                        ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                        trailAmount = ORP;
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                    trailAmount = ORP;
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }//End of OpenRecharge //Beginning of Open Recharge Points
                                    else if (route == "ORP")
                                    {
                                        using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                        {
                                            cmd.Parameters.AddWithValue("@email", email);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                    double getNewCredit = getPreviousCredit - phoneRechargeAmount;

                                                    //Effect the Update codes now
                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@points", getNewCredit);
                                                        cmd.Parameters.AddWithValue("@email", email);
                                                        cmd.ExecuteNonQuery();

                                                        //Add nothing since this is the Points given previousl as bonus

                                                        ResponseMsg = "Success! New balance Points is " + getNewCredit;
                                                        trailAmount = getNewCredit;
                                                    }
                                                }
                                            }
                                        }
                                    }//End of OpenRecharge Points // Beginning Of ConnectCitizens & ConnectAmbassadors
                                    else if (route == "CC")
                                    {
                                        using (cmd = new SqlCommand("Select SUM(amountdue),SUM(deductions) from CRCitizensEarnings where userid=@userid", con))
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read() && !dr.IsDBNull(0))
                                                {
                                                    double amountdue = double.Parse(dr.GetValue(0).ToString());
                                                    double deductions = double.Parse(dr.GetValue(1).ToString());
                                                    double currbalance = amountdue - deductions;
                                                    int balancecredit = int.Parse(currbalance.ToString());

                                                    if (balancecredit > phoneRechargeAmount)
                                                    {
                                                        double newdeduction = phoneRechargeAmount;

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    useridname = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        //Enter phone Recharge Deduction into Earnings
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Airtime VTU Recharge Cost");
                                                            cmd.Parameters.AddWithValue("@amountdue", 0);
                                                            cmd.Parameters.AddWithValue("@deductions", newdeduction);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Airtime VTU Recharge Cost");
                                                            cmd.Parameters.AddWithValue("@programid", UserId);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //Add the commissions
                                                        //2% for self recharge commission
                                                        dr.Dispose();
                                                        double SRC = 0.02 * phoneRechargeAmount;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Self Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@amountdue", SRC);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Self Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@programid", UserId);
                                                            cmd.ExecuteNonQuery();

                                                            ResponseMsg = "SUCCESS!";

                                                        }


                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralname = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }
                                                        //0.4% upline recharge commission
                                                        double RRC = 0.004 * phoneRechargeAmount;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                            cmd.Parameters.AddWithValue("@rank", "Referral Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@amountdue", RRC);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Referral Recharge Airtime Commission");
                                                            cmd.Parameters.AddWithValue("@programid", " ");
                                                            cmd.ExecuteNonQuery();

                                                            ResponseMsg = "SUCCESS!";

                                                        }

                                                        //TARC computation where applicable
                                                        #region TARC Computation
                                                        //Level 1
                                                        string RefLevel2 = "";
                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    RefLevel2 = dr.GetValue(0).ToString();

                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                    {//userid,tarc,dd,mm,yy
                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                        cmd.ExecuteNonQuery();
                                                                        ResponseMsg = "SUCCESS!";
                                                                    }

                                                                    //Level 2
                                                                    string RefLevel3 = "";
                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                        using (dr = cmd.ExecuteReader())
                                                                        {
                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                            {
                                                                                RefLevel3 = dr.GetValue(0).ToString();

                                                                                dr.Dispose();
                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                {//userid,tarc,dd,mm,yy
                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                    cmd.ExecuteNonQuery();
                                                                                    ResponseMsg = "SUCCESS!";
                                                                                }

                                                                                //Level 3
                                                                                string RefLevel4 = "";
                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                {
                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                    using (dr = cmd.ExecuteReader())
                                                                                    {
                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                        {
                                                                                            RefLevel4 = dr.GetValue(0).ToString();

                                                                                            dr.Dispose();
                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                cmd.ExecuteNonQuery();
                                                                                                ResponseMsg = "SUCCESS!";
                                                                                            }

                                                                                            //Level 4
                                                                                            string RefLevel5 = "";
                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                            {
                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                {
                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                    {
                                                                                                        RefLevel5 = dr.GetValue(0).ToString();

                                                                                                        dr.Dispose();
                                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                        {//userid,tarc,dd,mm,yy
                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                            cmd.ExecuteNonQuery();
                                                                                                            ResponseMsg = "SUCCESS!";
                                                                                                        }

                                                                                                        //Level 5
                                                                                                        string RefLevel6 = "";
                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                        {
                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                            {
                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                {
                                                                                                                    RefLevel6 = dr.GetValue(0).ToString();

                                                                                                                    dr.Dispose();
                                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                                    }

                                                                                                                    //Level 6
                                                                                                                    string RefLevel7 = "";
                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                    {
                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                        {
                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                            {
                                                                                                                                RefLevel7 = dr.GetValue(0).ToString();

                                                                                                                                dr.Dispose();
                                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                                }

                                                                                                                                //Level 7
                                                                                                                                string RefLevel8 = "";
                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                {
                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                    {
                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                        {
                                                                                                                                            RefLevel8 = dr.GetValue(0).ToString();

                                                                                                                                            dr.Dispose();
                                                                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                                ResponseMsg = "SUCCESS!";
                                                                                                                                            }

                                                                                                                                            //Level 8
                                                                                                                                            string RefLevel9 = "";
                                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                            {
                                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                                {
                                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                    {
                                                                                                                                                        RefLevel9 = dr.GetValue(0).ToString();

                                                                                                                                                        dr.Dispose();
                                                                                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                        {//userid,tarc,dd,mm,yy
                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                                            ResponseMsg = "SUCCESS!";
                                                                                                                                                        }

                                                                                                                                                        //Level 9
                                                                                                                                                        string RefLevel10 = "";
                                                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                        {
                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                                                            {
                                                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                {
                                                                                                                                                                    RefLevel10 = dr.GetValue(0).ToString();

                                                                                                                                                                    dr.Dispose();
                                                                                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                                                                                    }

                                                                                                                                                                    //Level 10
                                                                                                                                                                    string RefLevel11 = "";
                                                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                                    {
                                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                                                        {
                                                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                            {
                                                                                                                                                                                RefLevel11 = dr.GetValue(0).ToString();

                                                                                                                                                                                dr.Dispose();
                                                                                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel11);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * phoneRechargeAmount);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion
                                                    }
                                                    else
                                                    {
                                                        ResponseMsg = "Insufficient Credit Balance!";
                                                    }
                                                }
                                                else
                                                {
                                                    ResponseMsg = "Error!";
                                                }
                                            }
                                        }
                                    }// End Of ConnectCitizens & ConnectAmbassadors
                                    else
                                    {
                                        ResponseMsg = "Transaction failed! Please try again later.";
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        ResponseMsg = "No route response : NO01.";//No money in Cowrie Systems Wallet, fund with at least 100k;
                    }
                }
                else
                {
                    ResponseMsg = "Insufficient Balance. Kindly fund your wallet.";
                }
            }
            catch (Exception)
            {

            }
        }
        #endregion

        #region RechargeData_for_All_Networks
        public void RechargeData()
        {
            AirtimeClient airtime = new AirtimeClient(URL, ClientId, ClienKey);
            Network net = AirtimeClient.Parse(network);
            String msisdn = phone;
            int Rechargeamount = dataRechargeAmount;
            try
            {//clientBalance - Connect Recharge Registered users balance
                if (clientBalance >= dataRechargeAmount)
                {
                    BalanceResult balance = airtime.Balance();
                    double CreditBalance = balance.balance;
                    //CreditBalance - MNO balance
                    //Rechargeamount is the same as phoneRechargeAmount
                    if (CreditBalance >= dataRechargeAmount)
                    {
                        //Code to recharge a phone number
                        String xref = Guid.NewGuid().ToString("N");
                        String getResponseMessage = "";
                        using (con = new SqlConnection(conn))
                        {
                            con.Open();

                            AirtimeResult data = airtime.DataCredit(net, msisdn, Rechargeamount, xref);
                            getResponseMessage = data.message;

                            using (cmd = new SqlCommand("Insert into CRDataRechargeTracker(userid,route,network,amount,phonenumber,transactionid,xref,message,datecreated,dd,mm,yy) values (@userid,@route,@network,@amount,@phonenumber,@transactionid,@xref,@message,@datecreated,@dd,@mm,@yy)", con))
                            {
                                if (email == "" || email == null)
                                {
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                }
                                else
                                {
                                    cmd.Parameters.AddWithValue("@userid", email);
                                }
                                cmd.Parameters.AddWithValue("@route", route);//OR - Open Recharge,ORP - Openrecharge points,CC - ConnectCitizens
                                cmd.Parameters.AddWithValue("@network", network);
                                cmd.Parameters.AddWithValue("@amount", dataRechargeAmount);
                                cmd.Parameters.AddWithValue("@phonenumber", phone);
                                cmd.Parameters.AddWithValue("@transactionid", data.id);
                                cmd.Parameters.AddWithValue("@xref", data.xref);
                                cmd.Parameters.AddWithValue("@message", data.message);
                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToString());
                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                cmd.ExecuteNonQuery();
                            }

                            if (getResponseMessage == "SUCCESS")
                            {
                                //Update the balance
                                //Get new balance after recharge
                                int balanceAfterRecharge = clientBalance - dataRechargeAmount;
                                if (route == "OR")
                                {
                                    using (cmd = new SqlCommand("Select credit from CROpenCredit where email=@email", con))
                                    {
                                        cmd.Parameters.AddWithValue("@email", email);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                double getNewCredit = getPreviousCredit - dataRechargeAmount;

                                                //Effect the Update codes now
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Update CROpenCredit set credit=@credit where email=@email", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@credit", getNewCredit);
                                                    cmd.Parameters.AddWithValue("@email", email);
                                                    cmd.ExecuteNonQuery();

                                                    //Add the 5% commission for personal data recharge as ORP - Open Recharge Points
                                                    double ORP = 0.05 * dataRechargeAmount;
                                                    using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@email", email);
                                                        using (dr = cmd.ExecuteReader())
                                                        {
                                                            if (dr.Read())
                                                            {
                                                                double getPreviousPoints = double.Parse(dr.GetValue(0).ToString());
                                                                double newPoints = getPreviousPoints + ORP;

                                                                //Update the ORP
                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@email", email);
                                                                    cmd.Parameters.AddWithValue("@points", newPoints);
                                                                    cmd.ExecuteNonQuery();

                                                                    //Referral Bonus
                                                                    double ORC = 0.04 * dataRechargeAmount;
                                                                    using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                        using (dr = cmd.ExecuteReader())
                                                                        {
                                                                            if (dr.Read())
                                                                            {
                                                                                UserId = dr.GetValue(0).ToString();
                                                                                useridname = dr.GetValue(1).ToString();

                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                    cmd.Parameters.AddWithValue("@rank", "Open Recharge Data Commission for " + email);
                                                                                    cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                    cmd.Parameters.AddWithValue("@reason", "Open Recharge Data Commission for " + email);
                                                                                    cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                    cmd.ExecuteNonQuery();

                                                                                    ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                    trailAmount = newPoints;
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                ResponseMsg = "Success! New balance Points is " + newPoints;
                                                                                trailAmount = newPoints;
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {                                                                
                                                                //Update the ORP
                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Insert into CROpenPoints (points,email) values (@points,@email)", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@email", email);
                                                                    cmd.Parameters.AddWithValue("@points", ORP);
                                                                    cmd.ExecuteNonQuery();

                                                                    //Referral Bonus
                                                                    double ORC = 0.04 * dataRechargeAmount;
                                                                    using (cmd = new SqlCommand("Select userid,partnername from CRCitizensRegister where userid=@userid", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                        using (dr = cmd.ExecuteReader())
                                                                        {
                                                                            if (dr.Read())
                                                                            {
                                                                                UserId = dr.GetValue(0).ToString();
                                                                                useridname = dr.GetValue(1).ToString();

                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                    cmd.Parameters.AddWithValue("@rank", "Open Recharge Data Commission for " + email);
                                                                                    cmd.Parameters.AddWithValue("@amountdue", ORC);
                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                    cmd.Parameters.AddWithValue("@reason", "Open Recharge Data Commission for " + email);
                                                                                    cmd.Parameters.AddWithValue("@programid", UserId);
                                                                                    cmd.ExecuteNonQuery();

                                                                                    ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                    trailAmount = ORP;
                                                                                }
                                                                            }
                                                                            else
                                                                            {
                                                                                ResponseMsg = "Success! New balance Points is " + ORP;
                                                                                trailAmount = ORP;
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }//End of OpenRecharge //Beginning of Open Recharge Points
                                else if (route == "ORP")
                                {
                                    using (cmd = new SqlCommand("Select points from CROpenPoints where email=@email", con))
                                    {
                                        cmd.Parameters.AddWithValue("@email", email);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                double getPreviousCredit = double.Parse(dr.GetValue(0).ToString());
                                                double getNewCredit = getPreviousCredit - dataRechargeAmount;

                                                //Effect the Update codes now
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Update CROpenPoints set points=@points where email=@email", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@points", getNewCredit);
                                                    cmd.Parameters.AddWithValue("@email", email);
                                                    cmd.ExecuteNonQuery();

                                                    //Add nothing since this is the Points given previousl as bonus

                                                    ResponseMsg = "Success! New balance Points is " + getNewCredit;
                                                    trailAmount = getNewCredit;
                                                }
                                            }
                                        }
                                    }
                                }//End of OpenRecharge Points // Beginning Of ConnectCitizens & ConnectAmbassadors
                                else if (route == "CC")
                                {
                                    using (cmd = new SqlCommand("Select SUM(amountdue),SUM(deductions) from CRCitizensEarnings where userid=@userid", con))
                                    {
                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read() && !dr.IsDBNull(0))
                                            {
                                                double amountdue = double.Parse(dr.GetValue(0).ToString());
                                                double deductions = double.Parse(dr.GetValue(1).ToString());
                                                double currbalance = amountdue - deductions;
                                                int balancecredit = int.Parse(currbalance.ToString());

                                                if (balancecredit > dataRechargeAmount)
                                                {
                                                    double newdeduction = dataRechargeAmount;

                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                        using (dr = cmd.ExecuteReader())
                                                        {
                                                            if (dr.Read())
                                                            {
                                                                useridname = dr.GetValue(0).ToString();
                                                            }
                                                        }
                                                    }
                                                    //Enter phone Recharge Deduction into Earnings
                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                        cmd.Parameters.AddWithValue("@rank", "Data VTU Recharge Cost");
                                                        cmd.Parameters.AddWithValue("@amountdue", 0);
                                                        cmd.Parameters.AddWithValue("@deductions", newdeduction);
                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                        cmd.Parameters.AddWithValue("@reason", "Data VTU Recharge Cost");
                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                        dr.Dispose();
                                                        cmd.ExecuteNonQuery();
                                                    }

                                                    //Add the commissions
                                                    //10% for self recharge commission
                                                    double SRC = 0.1 * dataRechargeAmount;
                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                        cmd.Parameters.AddWithValue("@rank", "Self Recharge Data Commission");
                                                        cmd.Parameters.AddWithValue("@amountdue", SRC);
                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                        cmd.Parameters.AddWithValue("@reason", "Self Recharge Data Commission");
                                                        cmd.Parameters.AddWithValue("@programid", UserId);
                                                        cmd.ExecuteNonQuery();
                                                        ResponseMsg = "SUCCESS!";

                                                    }


                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("select partnername from crcitizensregister where userid=@userid", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                        using (dr = cmd.ExecuteReader())
                                                        {
                                                            if (dr.Read())
                                                            {
                                                                referralname = dr.GetValue(0).ToString();
                                                            }
                                                        }
                                                    }
                                                    //1.4% upline recharge commission
                                                    double RRC = 0.014 * dataRechargeAmount;
                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                    { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                        cmd.Parameters.AddWithValue("@rank", "Referral Data Recharge Commission");
                                                        cmd.Parameters.AddWithValue("@amountdue", RRC);
                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                        cmd.Parameters.AddWithValue("@reason", "Referral Data Recharge Commission");
                                                        cmd.Parameters.AddWithValue("@programid", " ");
                                                        cmd.ExecuteNonQuery();
                                                        ResponseMsg = "SUCCESS!";

                                                    }

                                                    //TDRC computation where applicable
                                                    #region TDRC Computation
                                                    //Level 1
                                                    string RefLevel2 = "";
                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                        using (dr = cmd.ExecuteReader())
                                                        {
                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                            {
                                                                RefLevel2 = dr.GetValue(0).ToString();

                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                {//userid,tarc,dd,mm,yy
                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                    cmd.ExecuteNonQuery();
                                                                    ResponseMsg = "SUCCESS!";
                                                                }

                                                                //Level 2
                                                                string RefLevel3 = "";
                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel2);
                                                                    using (dr = cmd.ExecuteReader())
                                                                    {
                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                        {
                                                                            RefLevel3 = dr.GetValue(0).ToString();

                                                                            dr.Dispose();
                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                            {//userid,tarc,dd,mm,yy
                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                cmd.ExecuteNonQuery();
                                                                                ResponseMsg = "SUCCESS!";
                                                                            }

                                                                            //Level 3
                                                                            string RefLevel4 = "";
                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                            {
                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel3);
                                                                                using (dr = cmd.ExecuteReader())
                                                                                {
                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                    {
                                                                                        RefLevel4 = dr.GetValue(0).ToString();

                                                                                        dr.Dispose();
                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                        {//userid,tarc,dd,mm,yy
                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                            cmd.ExecuteNonQuery();
                                                                                            ResponseMsg = "SUCCESS!";
                                                                                        }

                                                                                        //Level 4
                                                                                        string RefLevel5 = "";
                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                        {
                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel4);
                                                                                            using (dr = cmd.ExecuteReader())
                                                                                            {
                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                {
                                                                                                    RefLevel5 = dr.GetValue(0).ToString();

                                                                                                    dr.Dispose();
                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                        cmd.ExecuteNonQuery();
                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                    }

                                                                                                    //Level 5
                                                                                                    string RefLevel6 = "";
                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                    {
                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel5);
                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                        {
                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                            {
                                                                                                                RefLevel6 = dr.GetValue(0).ToString();

                                                                                                                dr.Dispose();
                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                }

                                                                                                                //Level 6
                                                                                                                string RefLevel7 = "";
                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                {
                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel6);
                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                    {
                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                        {
                                                                                                                            RefLevel7 = dr.GetValue(0).ToString();

                                                                                                                            dr.Dispose();
                                                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                ResponseMsg = "SUCCESS!";
                                                                                                                            }

                                                                                                                            //Level 7
                                                                                                                            string RefLevel8 = "";
                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                            {
                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel7);
                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                {
                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                    {
                                                                                                                                        RefLevel8 = dr.GetValue(0).ToString();

                                                                                                                                        dr.Dispose();
                                                                                                                                        using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                        {//userid,tarc,dd,mm,yy
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                            cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                            ResponseMsg = "SUCCESS!";
                                                                                                                                        }

                                                                                                                                        //Level 8
                                                                                                                                        string RefLevel9 = "";
                                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                        {
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", RefLevel8);
                                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                                            {
                                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                {
                                                                                                                                                    RefLevel9 = dr.GetValue(0).ToString();

                                                                                                                                                    dr.Dispose();
                                                                                                                                                    using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                    {//userid,tarc,dd,mm,yy
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                        cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                        ResponseMsg = "SUCCESS!";
                                                                                                                                                    }

                                                                                                                                                    //Level 9
                                                                                                                                                    string RefLevel10 = "";
                                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                    {
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", RefLevel9);
                                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                                        {
                                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                            {
                                                                                                                                                                RefLevel10 = dr.GetValue(0).ToString();

                                                                                                                                                                dr.Dispose();
                                                                                                                                                                using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                {//userid,tarc,dd,mm,yy
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                                                    ResponseMsg = "SUCCESS!";
                                                                                                                                                                }

                                                                                                                                                                //Level 10
                                                                                                                                                                string RefLevel11 = "";
                                                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                                {
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", RefLevel10);
                                                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                                                    {
                                                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                        {
                                                                                                                                                                            RefLevel11 = dr.GetValue(0).ToString();

                                                                                                                                                                            dr.Dispose();
                                                                                                                                                                            using (cmd = new SqlCommand("Insert into crambassadortarc(userid,tarc,dd,mm,yy) values (@userid,@tarc,@dd,@mm,@yy)", con))
                                                                                                                                                                            {//userid,tarc,dd,mm,yy
                                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", RefLevel11);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@tarc", 0.0001 * dataRechargeAmount);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                                                                                ResponseMsg = "SUCCESS!";
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                    #endregion
                                                }
                                                else
                                                {
                                                    ResponseMsg = "Insufficient Credit Balance!";
                                                }
                                            }
                                            else
                                            {
                                                ResponseMsg = "Error!";
                                            }
                                        }
                                    }
                                }// End Of ConnectCitizens & ConnectAmbassadors
                            }
                        }
                    }
                    else
                    {
                        ResponseMsg = "No route response : NO01.";//No money in Cowrie Systems Wallet, fund with at least 100k;
                    }
                }
                else
                {
                    ResponseMsg = "Insufficient Balance. Kindly fund your wallet.";
                }
            }
            catch (Exception)
            {

            }
        }
        #endregion

        #region GetUserId_Username_ReferralId_ReferralName
        private void GetUserIDName_ReferralDetails()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("Select partnername,refid from crcitizensregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            useridname = dr.GetValue(0).ToString();
                            referralID = dr.GetValue(1).ToString();

                            dr.Dispose();
                            using (cmd = new SqlCommand("Select partnername from crcitizensregister where userid=@userid", con))
                            {
                                cmd.Parameters.AddWithValue("@userid", referralID);
                                using (dr = cmd.ExecuteReader())
                                {
                                    if (dr.Read())
                                    {
                                        referralname = dr.GetValue(0).ToString();
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
        #endregion

        #region Global Recharge Commissions
        private void GlobalRechargeCommissions()
        {
            //Pass the values mm and yy from the design view
            int maxDay = DateTime.DaysInMonth(month, year);
            if (mm + 1 == month && yy == year || mm == 12 && yy + 1 == year)
            {
                using (con = new SqlConnection(conn))
                {
                    con.Open();//CRCitizensGRCTrack
                    //Check if the user has already been previously paid for GRC
                    using (cmd = new SqlCommand("Select userid from CRCitizensGRCTrack where mm=@mm and yy=@yy", con))
                    {
                        cmd.Parameters.AddWithValue("@mm", mm);
                        cmd.Parameters.AddWithValue("@yy", yy);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                ResponseMsg = "GRC has already been processed for this selected month.";
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Select SUM(Amount) from CRRechargeTracker where mm=@mm and yy=@yy", con))
                                {
                                    cmd.Parameters.AddWithValue("@mm", mm);
                                    cmd.Parameters.AddWithValue("@yy", yy);
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read())
                                        {
                                            int globalRechargeMonth = int.Parse(dr.GetValue(0).ToString());
                                            double sharePercentGRCMonth = 0.001 * globalRechargeMonth;

                                            dr.Dispose();
                                            con.Open();
                                            using (cmd = new SqlCommand("Select SUM(Amount) from CRRechargeTracker where mm=@mm and yy=@yy and userid=@userid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                cmd.Parameters.AddWithValue("@mm", mm);
                                                cmd.Parameters.AddWithValue("@yy", yy);
                                                using (dr = cmd.ExecuteReader())
                                                {
                                                    if (dr.Read())
                                                    {
                                                        int YourRechargeMonth = int.Parse(dr.GetValue(0).ToString());

                                                        GRC = YourRechargeMonth / globalRechargeMonth * sharePercentGRCMonth;

                                                        dr.Dispose();
                                                        //Earnings
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Global Recharge Airtime Commission for " + mm + "/" + yy);
                                                            cmd.Parameters.AddWithValue("@amountdue", GRC);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Global Recharge Airtime Commission for " + mm + "/" + yy);
                                                            cmd.Parameters.AddWithValue("@programid", UserId);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //GRC Track
                                                        using (cmd = new SqlCommand("Insert into CRCitizensGRCTrack(userid,status,amount,datecreated,mm,yy) values (@userid,@status,@amount,,@datecreated,@mm,@yy)", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@status", "Done");
                                                            cmd.Parameters.AddWithValue("@amount", GRC);
                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToString());
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Year);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            else
            {
                ResponseMsg = "Error: You are trying to generate 'Global Recharge Commissions' for an invalid month.";
            }
        }
        #endregion

        //TARC computation where applicable
        #region TARC Computation
        public void TARC()
        {//enter mm,yy from design view
            if (mm + 1 == month && yy == year || mm == 12 && yy + 1 == year)
            {
                using(con = new SqlConnection(conn))
                {
                    con.Open();

                    using (cmd = new SqlCommand("Select totalapv from crapvpoints where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                double totalAPV = double.Parse(dr.GetValue(0).ToString());
                                if (totalAPV >= 1625)
                                {
                                    dr.Dispose();
                                    using (cmd = new SqlCommand("Select SUM(tarc) from CRAmbassadorTARC where userid=@userid and mm=@mm and yy=@yy", con))
                                    {
                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                        cmd.Parameters.AddWithValue("@mm", mm);
                                        cmd.Parameters.AddWithValue("@mm", yy);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                double tarcTotal = double.Parse(dr.GetValue(0).ToString());
                                                //Insert into Earnings
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                    cmd.Parameters.AddWithValue("@rank", "Team Airtime Recharge Commission for " + mm + "/" + yy);
                                                    cmd.Parameters.AddWithValue("@amountdue", tarcTotal);
                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                    cmd.Parameters.AddWithValue("@reason", "Team Airtime Recharge Commission for " + mm + "/" + yy);
                                                    cmd.Parameters.AddWithValue("@programid", UserId);
                                                    cmd.ExecuteNonQuery();
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    ResponseMsg = "You must attain up to 1625APV before accessing TARC benefits.";
                                }
                            }
                            else
                            {
                                ResponseMsg = "TARC benefits are for Ambassadors who have attained up to 1625APV.";
                            }
                        }
                    }
                }
            }
            else
            {
                ResponseMsg = "TARC not due yet or invalid TARC date selected!";
            }
        }
        #endregion

        //TDRC computation where applicable
        #region TDRC Computation
        public void TDRC()
        {//enter mm,yy from design view
            if (mm + 1 == month && yy == year || mm == 12 && yy + 1 == year)
            {
                using (con = new SqlConnection(conn))
                {
                    con.Open();

                    using (cmd = new SqlCommand("Select totalapv from crapvpoints where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                double totalAPV = double.Parse(dr.GetValue(0).ToString());
                                if (totalAPV >= 1625)
                                {
                                    dr.Dispose();
                                    using (cmd = new SqlCommand("Select SUM(tarc) from CRAmbassadorTDRC where userid=@userid and mm=@mm and yy=@yy", con))
                                    {
                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                        cmd.Parameters.AddWithValue("@mm", mm);
                                        cmd.Parameters.AddWithValue("@mm", yy);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                double tdrcTotal = double.Parse(dr.GetValue(0).ToString());
                                                //Insert into Earnings
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                    cmd.Parameters.AddWithValue("@rank", "Team Data Recharge Commission for " + mm + "/" + yy);
                                                    cmd.Parameters.AddWithValue("@amountdue", tdrcTotal);
                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                    cmd.Parameters.AddWithValue("@reason", "Team Data Recharge Commission for " + mm + "/" + yy);
                                                    cmd.Parameters.AddWithValue("@programid", UserId);
                                                    cmd.ExecuteNonQuery();
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    ResponseMsg = "You must attain up to 1625APV before accessing TDRC benefits.";
                                }
                            }
                            else
                            {
                                ResponseMsg = "TDRC benefits are for Ambassadors who have attained up to 1625APV.";
                            }
                        }
                    }
                }
            }
            else
            {
                ResponseMsg = "TDRC not due yet or invalid TDRC date selected!";
            }
        }
       #endregion

        //Connect-Citizens
        #region CONNECTCITIZENS-ConnectMagnet_AI
        //ConnectCitizen Forgot Password
        public void ConnectCitizenForgotPassword()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select userid from crcitizensregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            int yourRandomEmailString = 6; //maximum: 32 
                            string emailconfcode = Guid.NewGuid().ToString("N").Substring(0, yourRandomEmailString);

                            dr.Dispose();
                            using (cmd = new SqlCommand("Update crcitizensregister set code=@code where userid=@userid", con))
                            {
                                cmd.Parameters.AddWithValue("@emailcode", emailconfcode);
                                cmd.Parameters.AddWithValue("@userid", UserId);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = emailconfcode;
                            }
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }

        public void ConnectCitizenUpdatePassword()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select code from crcitizensregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            string emailcode = dr.GetValue(0).ToString();
                            if(emailConfCODE == emailcode)
                            {
                                dr.Dispose();
                                using(cmd = new SqlCommand("Update crcitizensregister set password=@password where userid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@password", password);
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Password change was successful!";
                                }
                            }
                            else
                            {
                                ResponseMsg = "Invalid Code!";
                            }
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }


        //ConnectCitizen Log in
        public void ConnectCitizensLogin()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select userid,password,refid,email from CRCitizensRegister where userid=@userid and password=@password", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    password = Encrypt(password);
                    cmd.Parameters.AddWithValue("@password", password);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            string USERID = dr.GetValue(0).ToString();
                            string PASSWORD = dr.GetValue(1).ToString();
                            UserId = dr.GetValue(0).ToString();
                            referralID = dr.GetValue(2).ToString();
                            email = dr.GetValue(3).ToString();
                            if (USERID == UserId && PASSWORD == password)
                            {
                                ResponseMsg = "1";
                            }
                            else
                            {
                                ResponseMsg = "0";
                            }
                        }
                    }
                }
            }
        }
        //This class helps to detect which page to show when logging into the software for the first time
        //Whether any of the registration steps or straight to the dashboard if all steps have been completed

        //Verify UserID for Citizen Registration Step 2
        public void VerifyCitizenRegistrationStep2()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("Select userid,nickname,email from CRCitizensPreRegister where userid=@userid or email=@email", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    cmd.Parameters.AddWithValue("@email", email);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            UserId = dr.GetValue(0).ToString();
                            ResponseMsg = dr.GetValue(1).ToString();
                            email = dr.GetValue(2).ToString();
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }

        public void LoadCheck()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                using(cmd = new SqlCommand("Select status from CRCitizensPreRegister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            status = dr.GetValue(0).ToString();
                            if(status == "1")
                            {
                                ResponseMsg = "Page 1";
                            }
                            else if(status == "2")
                            {
                                ResponseMsg = "Page 2";
                            }
                            else if(status == "3")
                            {
                                ResponseMsg = "Page 3";
                            }
                        }
                    }
                }
            }
        }

        public void ConnectCitizensGenerateID()
        {
            try
            {
                int yourRandomEmailString = 8; //maximum: 32 
                UserId = Guid.NewGuid().ToString("N").Substring(0, yourRandomEmailString);
                using(con = new SqlConnection(conn))
                {
                    con.Open();
                    using (cmd = new SqlCommand("Select userid from CRCitizensPreRegister where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using(dr = cmd.ExecuteReader())
                        {
                            if(dr.Read())
                            {
                                int yourRandomEmailStrings = 8; //maximum: 32 
                                UserId = Guid.NewGuid().ToString("N").Substring(0, yourRandomEmailStrings);
                                ResponseMsg = UserId;
                            }
                            else
                            {
                                ResponseMsg = UserId;
                            }
                        }
                    }
                }
            }
            catch (Exception)
            {
                
            }
        }

        //Step 1 - User ID Pre Setup
        public void ConnectCitizensSignUpStep1()
        {
            try
            {
                using (con = new SqlConnection(conn))
                {
                    con.Open();
                    using (cmd = new SqlCommand("Select Userid from CRCitizensPreRegister where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                ResponseMsg = "This User's information already exists.";
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Select nickname from CRCitizensPreRegister where nickname=@nickname", con))
                                {
                                    cmd.Parameters.AddWithValue("@nickname", nickname);
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read())
                                        {
                                            ResponseMsg = "Nickname already in use.";
                                        }
                                        else
                                        {
                                            dr.Dispose();
                                            using (cmd = new SqlCommand("Insert into CRCitizensPreRegister(userid,email,password,nickname,status) values (@userid,@email,@password,@nickname,@status)", con))
                                            {
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                cmd.Parameters.AddWithValue("@email", email);
                                                cmd.Parameters.AddWithValue("@password", password);
                                                cmd.Parameters.AddWithValue("@nickname", nickname);
                                                cmd.Parameters.AddWithValue("@status", "1");
                                                cmd.ExecuteNonQuery();
                                                ResponseMsg = "Saved! Kindly proceed to make payment for your Connect Citizen VTU Pack";
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception)
            {                
                //
            }
        }

        //Step 2 - Fund Wallet for Registration
        // Before calling this method, let the user select the method of payment after completion
        public void ConnectCitizensSignUpStep2()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                //Insert into wallet
                using (cmd = new SqlCommand("Insert into CRCitizensFundWallet (userid,amount,datepaid,dateconfirmed) values (@userid,@amount,@datepaid,@dateconfirmed)", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    cmd.Parameters.AddWithValue("@amount", amount);
                    cmd.Parameters.AddWithValue("@datepaid", DateTime.Now.ToShortDateString());
                    cmd.Parameters.AddWithValue("@dateconfirmed", DateTime.Now.ToShortDateString());
                    cmd.ExecuteNonQuery();

                    //update pre-register
                    //// Call up this code method when confirming the user's payment in the company account.
                    //using (cmd = new SqlCommand("Update CRCitizensPreRegister set status=@status where userid=@userid", con))
                    //{
                    //    cmd.Parameters.AddWithValue("@status", "2");
                    //    cmd.Parameters.AddWithValue("@userid", UserId);
                    //    cmd.ExecuteNonQuery();
                    //}
                }                
            }
        }

        //Sign up for ConnectCitizens-This is the ConnectMagnet_Auto Networking Section
        //Third Registration step
        public void ConnectCitizensSignUpStep3()
        {
            try
            {
                using (con = new SqlConnection(conn))
                {
                    con.Open();//crcitizensplacementpay
                    using(cmd = new SqlCommand("Select partnername,email,phone,bankname from crcitizensregister where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using(dr = cmd.ExecuteReader())
                        {
                            if(dr.Read())
                            {
                                string pname = dr.GetValue(0).ToString();
                                string email = dr.GetValue(1).ToString();
                                string phone = dr.GetValue(2).ToString();
                                string bankname = dr.GetValue(0).ToString();

                                dr.Dispose();
                                using (cmd = new SqlCommand("Select Max(SN) from crcitizensplacement", con))
                                {
                                    using(dr = cmd.ExecuteReader())
                                    {
                                        if(dr.Read())
                                        {
                                            int SN = int.Parse(dr.GetValue(0).ToString());
                                            if (SN > 85)
                                            {
                                                int SN2 = SN;
                                                int SN1 = SN2 - 1;
                                               

                                                //Name Check
                                                using (cmd = new SqlCommand("Select useridname from crcitizensplacement where sn=@sn", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@sn", SN2);
                                                    using (dr = cmd.ExecuteReader())
                                                    {
                                                        if (dr.Read())
                                                        {
                                                            string checkname2 = dr.GetValue(0).ToString();
                                                            if (checkname2 == pname)
                                                            {
                                                                check2 = "1";

                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Select useridname from crcitizensplacement where sn=@sn", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@sn", SN1);
                                                                    using (dr = cmd.ExecuteReader())
                                                                    {
                                                                        if (dr.Read())
                                                                        {
                                                                            string checkname1 = dr.GetValue(0).ToString();
                                                                            if (checkname1 == pname)
                                                                            {
                                                                                check1 = "1";                                                                                
                                                                            }
                                                                            else
                                                                            {
                                                                                check1 = "0";
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {
                                                                check2 = "0";
                                                            }
                                                            if (check2 == "1" && check1 == "1")
                                                            {
                                                                ResponseMsg = "Registration unsuccessful at this time, kindly try again later.";
                                                            }
                                                            else if(check2 == "0")
                                                            {
                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Select userid from CRCitizensRegister where email=@userid", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                    using (dr = cmd.ExecuteReader())
                                                                    {
                                                                        if (dr.Read())
                                                                        {
                                                                            ResponseMsg = "User ID already exists!, kindly login and try again.";
                                                                        }
                                                                        else
                                                                        {
                                                                            dr.Dispose();
                                                                            using (cmd = new SqlCommand("Insert into CRCitizensRegister(password,partnername,email,phone,city,state,country,nationality,lastlogin,datereg,reflink,currentdate,accountstatus,dd,mm,yy,code,codestatus,userid,gender,bankname,accountno,refid,currency,withdrawlimit,withdrawstatus,codeR,crp,vendor,idcard,idno) values (@password,@partnername,@email,@phone,@city,@state,@country,@nationality,@lastlogin,@datereg,@reflink,@currentdate,@accountstatus,@dd,@mm,@yy,@code,@codestatus,@userid,@gender,@bankname,@accountno,@refid,@currency,@withdrawlimit,@withdrawstatus,@codeR,@crp,@vendor,@idcard,@idno)", con))
                                                                            {
                                                                                //Generate Email Code
                                                                                cmd.Parameters.AddWithValue("@password", password);
                                                                                cmd.Parameters.AddWithValue("@partnername", partnername);
                                                                                cmd.Parameters.AddWithValue("@email", email);
                                                                                cmd.Parameters.AddWithValue("@phone", phone);
                                                                                cmd.Parameters.AddWithValue("@city", city.Trim().ToUpper());
                                                                                cmd.Parameters.AddWithValue("@state", state.Trim().ToUpper());
                                                                                cmd.Parameters.AddWithValue("@country", country.Trim().ToUpper());
                                                                                cmd.Parameters.AddWithValue("@nationality", nationality.Trim().ToUpper());
                                                                                cmd.Parameters.AddWithValue("@lastlogin", DateTime.Now);
                                                                                cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                                                cmd.Parameters.AddWithValue("@reflink", refCode);
                                                                                cmd.Parameters.AddWithValue("@currentdate", DateTime.Now.ToShortDateString());
                                                                                cmd.Parameters.AddWithValue("@accountstatus", "Active");
                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                cmd.Parameters.AddWithValue("@code", emailConfCODE);
                                                                                cmd.Parameters.AddWithValue("@codestatus", "0");
                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                cmd.Parameters.AddWithValue("@gender", gender);
                                                                                cmd.Parameters.AddWithValue("@bankname", bankname);
                                                                                cmd.Parameters.AddWithValue("@accountno", accountno);
                                                                                cmd.Parameters.AddWithValue("@refid", Referrer);
                                                                                cmd.Parameters.AddWithValue("@currency", currency);
                                                                                cmd.Parameters.AddWithValue("@withdrawlimit", 0);
                                                                                cmd.Parameters.AddWithValue("@withdrawstatus", 1);
                                                                                cmd.Parameters.AddWithValue("@codeR", 0);
                                                                                cmd.Parameters.AddWithValue("@crp", 0);
                                                                                cmd.Parameters.AddWithValue("@vendor", vendor);
                                                                                cmd.Parameters.AddWithValue("@idcard", IDCard);
                                                                                cmd.Parameters.AddWithValue("@idno", IDNo);
                                                                                dr.Dispose();
                                                                                cmd.ExecuteNonQuery();

                                                                                //update pre-register
                                                                                using (cmd = new SqlCommand("Update CRCitizensPreRegister set status=@status where userid=@userid", con))
                                                                                {
                                                                                    cmd.Parameters.AddWithValue("@status", "3");
                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                    cmd.ExecuteNonQuery();
                                                                                }

                                                                                //
                                                                                //
                                                                                //
                                                                                //Send Email - //Format this email section well
                                                                                //create the mail message
                                                                                //MailMessage mail = new MailMessage();
                                                                                ////set the FROM address
                                                                                //mail.From = new MailAddress("info@Winninglifeinternational.com");
                                                                                ////set the RECIPIENTS
                                                                                //mail.To.Add(email);
                                                                                ////enter a SUBJECT
                                                                                //mail.Subject = "Your Email Confirmation Code from WinningLife";
                                                                                ////Enter the message BODY
                                                                                //mail.Body = "From WinningLife International:<p>" + "<p>Thank you for registering on WinningLife International. <p><p>Your Email Confirmation Code is - <strong>" + emailConfCODE + "</strong. <p>To complete your registration kindly fund your wallet.</p> <p><p>- WinningLife International Team";
                                                                                ////set the mail server (default should be smtp.1and1.com)
                                                                                //SmtpClient smtp = new SmtpClient("smtp.1and1.com");
                                                                                ////Enter your full e-mail address and password
                                                                                //smtp.Credentials = new NetworkCredential("info@360healthwealth.com", "{fRA.8SJekqx");
                                                                                ////send the message 
                                                                                //smtp.Send(mail);

                                                                                //SendHtmlFormattedEmail(email, "Your Email Confirmation Code from WinningLife", body);

                                                                                ResponseMsg = "Success!";
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {

                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Insert into CRCitizensRegister(password,partnername,email,phone,city,state,country,nationality,lastlogin,datereg,reflink,currentdate,accountstatus,dd,mm,yy,code,codestatus,userid,gender,bankname,accountno,refid,currency,withdrawlimit,withdrawstatus,codeR,crp,vendor,idcard,idno) values (@password,@partnername,@email,@phone,@city,@state,@country,@nationality,@lastlogin,@datereg,@reflink,@currentdate,@accountstatus,@dd,@mm,@yy,@code,@codestatus,@userid,@gender,@bankname,@accountno,@refid,@currency,@withdrawlimit,@withdrawstatus,@codeR,@crp,@vendor,@idcard,@idno)", con))
                                {
                                    //Generate Email Code
                                    cmd.Parameters.AddWithValue("@password", password);
                                    cmd.Parameters.AddWithValue("@partnername", partnername);
                                    cmd.Parameters.AddWithValue("@email", email);
                                    cmd.Parameters.AddWithValue("@phone", phone);
                                    cmd.Parameters.AddWithValue("@city", city.Trim().ToUpper());
                                    cmd.Parameters.AddWithValue("@state", state.Trim().ToUpper());
                                    cmd.Parameters.AddWithValue("@country", country.Trim().ToUpper());
                                    cmd.Parameters.AddWithValue("@nationality", nationality.Trim().ToUpper());
                                    cmd.Parameters.AddWithValue("@lastlogin", DateTime.Now);
                                    cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                    cmd.Parameters.AddWithValue("@reflink", refCode);
                                    cmd.Parameters.AddWithValue("@currentdate", DateTime.Now.ToShortDateString());
                                    cmd.Parameters.AddWithValue("@accountstatus", "Active");
                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                    cmd.Parameters.AddWithValue("@code", emailConfCODE);
                                    cmd.Parameters.AddWithValue("@codestatus", "0");
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    cmd.Parameters.AddWithValue("@gender", gender);
                                    cmd.Parameters.AddWithValue("@bankname", bankname);
                                    cmd.Parameters.AddWithValue("@accountno", accountno);
                                    cmd.Parameters.AddWithValue("@refid", Referrer);
                                    cmd.Parameters.AddWithValue("@currency", currency);
                                    cmd.Parameters.AddWithValue("@withdrawlimit", 0);
                                    cmd.Parameters.AddWithValue("@withdrawstatus", 1);
                                    cmd.Parameters.AddWithValue("@codeR", 0);
                                    cmd.Parameters.AddWithValue("@crp", 0);
                                    cmd.Parameters.AddWithValue("@vendor", vendor);
                                    cmd.Parameters.AddWithValue("@idcard", IDCard);
                                    cmd.Parameters.AddWithValue("@idno", IDNo);
                                    dr.Dispose();
                                    cmd.ExecuteNonQuery();

                                    //update pre-register
                                    using (cmd = new SqlCommand("Update CRCitizensPreRegister set status=@status where userid=@userid", con))
                                    {
                                        cmd.Parameters.AddWithValue("@status", "3");
                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                        cmd.ExecuteNonQuery();
                                    }

                                    //
                                    //
                                    //
                                    //Send Email - //Format this email section well
                                    //create the mail message
                                    //MailMessage mail = new MailMessage();
                                    ////set the FROM address
                                    //mail.From = new MailAddress("info@Winninglifeinternational.com");
                                    ////set the RECIPIENTS
                                    //mail.To.Add(email);
                                    ////enter a SUBJECT
                                    //mail.Subject = "Your Email Confirmation Code from WinningLife";
                                    ////Enter the message BODY
                                    //mail.Body = "From WinningLife International:<p>" + "<p>Thank you for registering on WinningLife International. <p><p>Your Email Confirmation Code is - <strong>" + emailConfCODE + "</strong. <p>To complete your registration kindly fund your wallet.</p> <p><p>- WinningLife International Team";
                                    ////set the mail server (default should be smtp.1and1.com)
                                    //SmtpClient smtp = new SmtpClient("smtp.1and1.com");
                                    ////Enter your full e-mail address and password
                                    //smtp.Credentials = new NetworkCredential("info@360healthwealth.com", "{fRA.8SJekqx");
                                    ////send the message 
                                    //smtp.Send(mail);

                                    //SendHtmlFormattedEmail(email, "Your Email Confirmation Code from WinningLife", body);

                                    ResponseMsg = "Success!";
                                }
                            }
                        }
                    }                    
                }
            }
            catch (Exception)
            {
                
            }
        }

        public void CheckBeforeSubAccount()
        {
            try
            {
                using (con = new SqlConnection(conn))
                {
                    con.Open();//crcitizensplacementpay
                    using (cmd = new SqlCommand("Select partnername,email,phone,bankname from crcitizensregister where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                string pname = dr.GetValue(0).ToString();
                                string email = dr.GetValue(1).ToString();
                                string phone = dr.GetValue(2).ToString();
                                string bankname = dr.GetValue(3).ToString();

                                dr.Dispose();
                                using (cmd = new SqlCommand("Select Max(SN) from crcitizensplacement", con))
                                {
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read() && !dr.IsDBNull(0))
                                        {
                                            int SN = int.Parse(dr.GetValue(0).ToString());
                                            if (SN > 85)
                                            {
                                                int SN2 = SN;
                                                int SN1 = SN2 - 1;


                                                //Name Check
                                                using (cmd = new SqlCommand("Select useridname from crcitizensplacement where sn=@sn", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@sn", SN2);
                                                    using (dr = cmd.ExecuteReader())
                                                    {
                                                        if (dr.Read())
                                                        {
                                                            string checkname2 = dr.GetValue(0).ToString();
                                                            if (checkname2 == pname)
                                                            {
                                                                check2 = "1";

                                                                dr.Dispose();
                                                                using (cmd = new SqlCommand("Select useridname from crcitizensplacement where sn=@sn", con))
                                                                {
                                                                    cmd.Parameters.AddWithValue("@sn", SN1);
                                                                    using (dr = cmd.ExecuteReader())
                                                                    {
                                                                        if (dr.Read())
                                                                        {
                                                                            string checkname1 = dr.GetValue(0).ToString();
                                                                            if (checkname1 == pname)
                                                                            {
                                                                                check1 = "1";
                                                                            }
                                                                            else
                                                                            {
                                                                                check1 = "0";
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {
                                                                check2 = "0";
                                                            }
                                                            if (check2 == "1" && check1 == "1")
                                                            {
                                                                ResponseMsg = "Registration unsuccessful at this time, kindly try again later.";
                                                            }
                                                            else
                                                            {
                                                                ResponseMsg = "0";
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                ResponseMsg = "0";
                                            }
                                        }
                                        else
                                        {
                                            ResponseMsg = "0";
                                        }
                                    }
                                }
                            }
                            else
                            {
                                ResponseMsg = "Invalid data, please ensure this account was properly registered.";
                            }
                        }
                    }
                }
            }
            catch(Exception)
            {

            }
        }

        //Check uniqueness of Transaction ID Generated for PayStack
        public void checkCitizensTranID()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select tranid from crcitizenpaystacktrack where tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            ResponseMsg = "1";
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }

        //ConnectCitizen PayStack Track
        public void CRCitizenPayStackTrack()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select tranid from crcitizenpaystacktrack where userid=@userid and tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            ResponseMsg = "Transaction already exists.";
                        }
                        else
                        {
                            dr.Dispose();
                            using (cmd = new SqlCommand("Insert into crcitizenpaystacktrack (userid,tranid,amount,date,status) values (@userid,@tranid,@amount,@date,@status)", con))
                            {
                                cmd.Parameters.AddWithValue("@userid", UserId);
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToString());
                                cmd.Parameters.AddWithValue("@status", 0);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Saved!";
                            }
                        }
                    }
                }
            }
        }

        //Fund Connect Citizen Wallet via PayStack
        public void ConnectCitizenFundWallet()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select amount from crcitizensfundwallet where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            int amount = int.Parse(dr.GetValue(0).ToString());
                            int newAmount = amount + PayStackAmount;

                            dr.Dispose();

                            using (cmd = new SqlCommand("Select status from crcitizenpaystacktrack where tranid=@tranid and amount=@amount", con))
                            {
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                using (dr = cmd.ExecuteReader())
                                {
                                    if (dr.Read())
                                    {
                                        int getStatus = int.Parse(dr.GetValue(0).ToString());
                                        if (getStatus == 0)
                                        {
                                            using (cmd = new SqlCommand("Update crcitizenpaystacktrack set status=@status where tranid=@tranid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@status", 1);
                                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                                dr.Dispose();
                                                cmd.ExecuteNonQuery();

                                                using (cmd = new SqlCommand("Update crcitizensfundwallet set amount=@amount,dateconfirmed=@dateconfirmed where userid=@userid", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@amount", newAmount);
                                                    cmd.Parameters.AddWithValue("@dateconfirmed", DateTime.Now.ToString());
                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.ExecuteNonQuery();
                                                    ResponseMsg = "Wallet Funded!";
                                                    
                                                }
                                            }
                                        }
                                        else if (getStatus == 1)
                                        {
                                            ResponseMsg = "Invalid Transaction ID: Has been previously used!";
                                        }
                                    }
                                    else
                                    {
                                        ResponseMsg = "Invalid Transaction ID.";
                                    }
                                }
                            }
                        }
                        else
                        {
                            int amount = 0;
                            int newAmount = amount + PayStackAmount;

                            dr.Dispose();

                            using (cmd = new SqlCommand("Select status from crcitizenpaystacktrack where tranid=@tranid and amount=@amount", con))
                            {
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                using (dr = cmd.ExecuteReader())
                                {
                                    if (dr.Read())
                                    {
                                        int getStatus = int.Parse(dr.GetValue(0).ToString());
                                        if (getStatus == 0)
                                        {
                                            using (cmd = new SqlCommand("Update crcitizenpaystacktrack set status=@status where tranid=@tranid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@status", 1);
                                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                                dr.Dispose();
                                                cmd.ExecuteNonQuery();

                                                using (cmd = new SqlCommand("Insert into crcitizensfundwallet (userid,amount,datepaid,dateconfirmed) values (@userid,@amount,@datepaid,@dateconfirmed)", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.Parameters.AddWithValue("@amount", newAmount);
                                                    cmd.Parameters.AddWithValue("@datepaid", DateTime.Now.ToString());
                                                    cmd.Parameters.AddWithValue("@dateconfirmed", DateTime.Now.ToString());
                                                    //cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.ExecuteNonQuery();
                                                    ResponseMsg = "Wallet Funded!";
                                                    //update pre-register
                                                    // Call up this code method when confirming the user's payment in the company account.
                                                    if (newAmount >= 5180)
                                                    {
                                                        using (cmd = new SqlCommand("Update CRCitizensPreRegister set status=@status where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@status", "2");
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                    }
                                                    else
                                                    {
                                                        ResponseMsg = "Amount too low for transaction.";
                                                    }
                                                }
                                            }
                                        }
                                        else if (getStatus == 1)
                                        {
                                            ResponseMsg = "Invalid Transaction ID: Has been previously used!";
                                        }
                                    }
                                    else
                                    {
                                        ResponseMsg = "Invalid Transaction ID.";
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        public void CheckConnectCitizenFundWalletBalance()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select amount from crcitizensfundwallet where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            amount = int.Parse(dr.GetValue(0).ToString());
                        }
                    }
                }
            }
        }

        public void ConnectCitizenVendorUpgrade()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select amount from crcitizensfundwallet where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            amount = int.Parse(dr.GetValue(0).ToString());

                            if(amount >= 5000)
                            {
                                double newAmount = amount - 5000;
                                dr.Dispose();
                                //Update Fund Wallet
                                using (cmd = new SqlCommand("Update crcitizensfundwallet set amount=@amount where userid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    cmd.Parameters.AddWithValue("@amount", newAmount);
                                    cmd.ExecuteNonQuery();
                                }

                                //Update Registration
                                using (cmd = new SqlCommand("Update crcitizensregister set vendor=@vendor where userid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    cmd.Parameters.AddWithValue("@vendor", 1);
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Upgrade was Successful!";
                                }
                            }
                            else
                            {
                                ResponseMsg = "Insufficient Wallet Balance. Kindly fund your wallet using any of our payment channels";
                            }
                        }
                    }
                }
            }
        }
        public void CitizenStatus()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();

                using (cmd = new SqlCommand("Select nickname from crcitizenspreregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            nickname = dr.GetValue(0).ToString();
                        }
                    }
                }

                dr.Dispose();
                using(cmd = new SqlCommand("Select vendor from crcitizensregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read() && !dr.IsDBNull(0))
                        {
                            string getVendor = dr.GetValue(0).ToString();
                            if (getVendor == "1")
                            {
                                vendor = 1;
                            }
                            else
                            {
                                vendor = 0;
                            }
                        }
                    }
                }

                dr.Dispose();
                using(cmd = new SqlCommand("Select crp from crcitizensregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            string getCRP = dr.GetValue(0).ToString();
                            if(getCRP == "1")
                            {
                                Referrer = "10";
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Select count(refid) from crcitizensregister where refid=@userid", con))
                                {
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    using (dr = cmd.ExecuteReader())
                                    {
                                        if (dr.Read() && !dr.IsDBNull(0))
                                        {
                                            int getReferrer = int.Parse(dr.GetValue(0).ToString());
                                            if (getReferrer == 10)
                                            {
                                                Referrer = dr.GetValue(0).ToString();
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Update crcitizensregister set crp=@crp where userid=@userid", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                    cmd.Parameters.AddWithValue("@crp", 1);
                                                    cmd.ExecuteNonQuery();
                                                }
                                            }
                                            else 
                                            { 
                                                Referrer = "0";
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }                
            }
        }

        //Retrieves the Credit wallet balance for a ConnectCitizen User
        public void ConnectCitizenCheckFundCreditBalance()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select amount from CRCitizensFundWallet where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            amount = int.Parse(dr.GetValue(0).ToString());
                        }
                    }
                }
            }
        }

        //Retrieves the openRechargePoints(ORP) wallet balance for an OpenRecharge User
        public void ConnectCitizenCheckEarningsBalance()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select SUM(amountdue),SUM(deductions) from CRCitizensEarnings where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            double amountdue = double.Parse(dr.GetValue(0).ToString());
                            double deductions = double.Parse(dr.GetValue(1).ToString());
                            double getbalance = amountdue - deductions;
                            amount = int.Parse(getbalance.ToString());
                        }
                        else
                        {
                            credit = 0;
                        }
                    }
                }
            }
        }


        //ConnectMagnets AI section of automatic placements, auto accounts, auto earnings and commissions 

        public void ConnectCitizensPlacement()
        {
            try
            {
                ///Sort out the ID track properly
                string place = "0";
                string refer = "0";
                string name = "0";
                string referid = "0";
                //PID = placementid;
                UserIdsKeep = UserId;
                using (con = new SqlConnection(conn))
                {
                    con.Open();
                    //using (TransactionScope scope = new TransactionScope())
                    //{
                    //check if the amount in the fund wallet is enough for the 5000 transaction  // email=@email and and program=@program
                    using (cmd = new SqlCommand("Select amount from CRCitizensFundwallet where userid=@userid", con))
                    {
                        //cmd.Parameters.AddWithValue("@email", username);
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        //cmd.Parameters.AddWithValue("@program", program);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                double PreviousAmount = double.Parse(dr.GetValue(0).ToString());
                                double regAmount;
                                if (vendor == 1)
                                {
                                    regAmount = 10000;
                                }
                                else
                                {
                                    regAmount = 5000;
                                }
                                double newAmount = PreviousAmount - regAmount;
                                if (PreviousAmount >= regAmount)
                                {
                                    dr.Dispose();
                                    //using (cmd = new SqlCommand("Select partnername from CRCitizensregister where userid=@placementid", con))
                                    //{
                                    //    cmd.Parameters.AddWithValue("@placementid", placementid);
                                    //    using (dr = cmd.ExecuteReader())
                                    //    {
                                    //        if (dr.Read())
                                    //        {
                                    //            placementname = dr.GetValue(0).ToString();
                                    //            place = "1";
                                    //        }
                                    //        else
                                    //        {
                                    //            //ResponseMsg = "Invalid Placement ID.";
                                    //        }
                                    //    }

                                    //    dr.Dispose();

                                    using (cmd = new SqlCommand("Select refid from CRCitizensregister where userid=@referralid", con))
                                    {
                                        cmd.Parameters.AddWithValue("@referralid", UserId);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read() && !dr.IsDBNull(0))
                                            {
                                                string referID = dr.GetValue(0).ToString();
                                                referralID = referID;
                                                dr.Dispose();
                                                using (cmd = new SqlCommand("Select partnername from CRCitizensregister where userid=@referralid", con))
                                                {
                                                    cmd.Parameters.AddWithValue("@referralid", referID);
                                                    using (dr = cmd.ExecuteReader())
                                                    {
                                                        if (dr.Read())
                                                        {
                                                            referralname = dr.GetValue(0).ToString();
                                                            refer = "1";
                                                        }
                                                        else
                                                        {
                                                            referralname = "Emmanuel Ogbewele";
                                                            refer = "1";
                                                        }
                                                    }
                                                }
                                            }
                                            //else
                                            //{
                                            //    ResponseMsg = "Invalid Referral ID.";
                                            //}
                                        }
                                        //}

                                        dr.Dispose();
                                        using (cmd = new SqlCommand("Select partnername from CRCitizensregister where userid=@userid", con))
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    useridname = dr.GetValue(0).ToString();
                                                    name = "1";
                                                }
                                                else
                                                {
                                                    //ResponseMsg = "Invalid Placement ID.";
                                                }
                                            }
                                        }

                                        dr.Dispose();
                                        using (cmd = new SqlCommand("Select currency from CRCitizensregister where userid=@userid", con))
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read())
                                                {
                                                    currency = dr.GetValue(0).ToString();
                                                }
                                                else
                                                {
                                                    //ResponseMsg = "Invalid Placement ID.";
                                                }
                                            }
                                        }
                                    }

                                    if (refer == "1" && name == "1")
                                    {
                                        int yourRandomStringLengthID = 8; //maximum: 32 
                                        programID = Guid.NewGuid().ToString("N").Substring(0, yourRandomStringLengthID);

                                        dr.Dispose();
                                        using (cmd = new SqlCommand("Select count(sn) from CRCitizensPlacement", con))
                                        {
                                            using (dr = cmd.ExecuteReader())
                                            {
                                                if (dr.Read() && !dr.IsDBNull(0))
                                                {
                                                    double countSN = double.Parse(dr.GetValue(0).ToString());

                                                    int i = 0;
                                                    AssignedSN = countSN + 1;

                                                    //Add the auto counter for the Auto Accounts
                                                    #region Add the auto counter for the Auto Accounts
                                                    if (countSN >= 95)
                                                    {
                                                        using (cmd = new SqlCommand("Select nextauto from CRCitizensNextAuto", con))
                                                        {
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    int getNextAuto = int.Parse(dr.GetValue(0).ToString());
                                                                    //update
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update CRCitizensNextAuto set nextauto=@nextauto", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@nextauto", getNextAuto + 4);
                                                                        cmd.ExecuteNonQuery();
                                                                    }
                                                                    if (AssignedSN == getNextAuto)
                                                                    {
                                                                        AutoAccounts = 1;
                                                                    }
                                                                    else
                                                                    {
                                                                        AutoAccounts = 0;
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into CRCitizensNextAuto(nextauto) values (@nextauto)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@nextauto", 99);
                                                                        cmd.ExecuteNonQuery();
                                                                        AutoAccounts = 0;
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                    else
                                                    {
                                                        AutoAccounts = 0;
                                                    }
                                                    #endregion

                                                    //Now Enter the Placement details based on whether its a normal or auto account
                                                    #region Now Enter the Placement details based on whether its a normal or auto account
                                                    //Fill in the parameters, based on whether AutoAccounts = 0/1

                                                    //confirm if programID exists
                                                    dr.Dispose();
                                                    using (cmd = new SqlCommand("Select programid from CRCitizensPlacement where programid=@programid", con))
                                                    {
                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                        using (dr = cmd.ExecuteReader())
                                                        {
                                                            if (dr.Read())
                                                            {
                                                                int yourRandomStringLengthIDxx = 8; //maximum: 32 
                                                                programID = Guid.NewGuid().ToString("N").Substring(0, yourRandomStringLengthIDxx);
                                                            }
                                                            else
                                                            {

                                                            }
                                                        }
                                                    }

                                                    if (AutoAccounts == 0)
                                                    {
                                                        #region Normal Account Creation ONLY


                                                        double firstLinePlacement = (AssignedSN * 4) + 1;
                                                        dr.Dispose();
                                                        //Cycle1 - Line 1 // Line 4 <-- No Payment
                                                        //
                                                        //


                                                        //Cycle 0 (First line payment) // Line 4
                                                        //////////////////////////
                                                        //////    Pay 0    ///////
                                                        /////////////////////////
                                                        Pay0 = firstLinePlacement;
                                                        PayAmt0 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay0);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 1");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //Cycle 1 (pay only Line 2) // Line 16
                                                        //////////////////////////
                                                        //////    Pay 4    ///////
                                                        /////////////////////////
                                                        Pay4 = (firstLinePlacement * 4) + 1;
                                                        PayAmt4 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay4);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 3    ///////
                                                        /////////////////////////
                                                        Pay3 = Pay4 - 4;
                                                        PayAmt3 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay3);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 2    ///////
                                                        /////////////////////////
                                                        Pay2 = Pay3 - 4;
                                                        PayAmt2 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay2);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 1    ///////
                                                        /////////////////////////
                                                        Pay1 = Pay2 - 4;
                                                        PayAmt1 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay1);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////

                                                        //CYcle 2 - Line 1 // Line 64
                                                        //////////////////////////
                                                        //////    Pay 8    ///////
                                                        /////////////////////////
                                                        Pay8 = (Pay4 * 4) + 1;
                                                        PayAmt8 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay8);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 7    ///////
                                                        /////////////////////////
                                                        Pay7 = Pay8 - 16;
                                                        PayAmt7 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay7);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 6    ///////
                                                        /////////////////////////
                                                        Pay6 = Pay7 - 16;
                                                        PayAmt6 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay6);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 5    ///////
                                                        /////////////////////////
                                                        Pay5 = Pay6 - 16;
                                                        PayAmt5 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay5);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////


                                                        //Cycle 2 - Line 2 // Line 256 

                                                        ///////////////////////////
                                                        //////    Pay 24    //////
                                                        /////////////////////////
                                                        Pay24 = (Pay8 * 4) + 1;
                                                        PayAmt24 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay24);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 23    //////
                                                        /////////////////////////
                                                        Pay23 = Pay24 - 16;
                                                        PayAmt23 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay23);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 22    //////
                                                        /////////////////////////
                                                        Pay22 = Pay23 - 16;
                                                        PayAmt22 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay22);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 21    //////
                                                        /////////////////////////
                                                        Pay21 = Pay22 - 16;
                                                        PayAmt21 = 7500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay21);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 20    //////
                                                        /////////////////////////
                                                        Pay20 = Pay21 - 16;
                                                        PayAmt20 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay20);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 19    //////
                                                        /////////////////////////
                                                        Pay19 = Pay20 - 16;
                                                        PayAmt19 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay19);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 18    //////
                                                        /////////////////////////
                                                        Pay18 = Pay19 - 16;
                                                        PayAmt18 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay18);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 17    //////
                                                        /////////////////////////
                                                        Pay17 = Pay18 - 16;
                                                        PayAmt17 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay17);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 16    //////
                                                        /////////////////////////
                                                        Pay16 = Pay17 - 16;
                                                        PayAmt16 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay16);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 15    //////
                                                        /////////////////////////
                                                        Pay15 = Pay16 - 16;
                                                        PayAmt15 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay15);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 14    //////
                                                        /////////////////////////
                                                        Pay14 = Pay15 - 16;
                                                        PayAmt14 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay14);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 13    //////
                                                        /////////////////////////
                                                        Pay13 = Pay14 - 16;
                                                        PayAmt13 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay13);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 12    //////
                                                        /////////////////////////
                                                        Pay12 = Pay13 - 16;
                                                        PayAmt12 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay12);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 11    ///////
                                                        /////////////////////////
                                                        Pay11 = Pay12 - 16;
                                                        PayAmt11 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay11);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay10 = Pay11 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay10);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay9 = Pay10 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay9);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }


                                                        ///////////////////////////////////////////////////////////////

                                                        //(Pay Only Line 1) Line 1024

                                                        //////////////////////////
                                                        //////    Pay 28    ///////
                                                        /////////////////////////
                                                        Pay28 = (Pay24 * 4) + 1;
                                                        PayAmt28 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "3000CBPV");//Smart Phone
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay28);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 5");//Smart Phone(30k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        ///////////////////////////////////////////////////////////////

                                                        ///////////////////////////////////////////////////////////////

                                                        /////////////////////////////////////
                                                        //         Level 1-Line 4096      //
                                                        ////////////////////////////////////

                                                        ////////////////////////////
                                                        ////////    Pay 29    ///////
                                                        ///////////////////////////
                                                        Pay29 = (Pay28 * 4) + 1;
                                                        PayAmt29 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "6000CBPV");//Tablet
                                                            cmd.Parameters.AddWithValue("@payamount", 0);
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay29);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 6");//Smart Tab(60k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 30    ///////
                                                        /////////////////////////
                                                        //Level 2 - Line 16384
                                                        Pay30 = (Pay29 * 4) + 1;
                                                        PayAmt30 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "12000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//Dubai Trip
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay30);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 7");//Dubai Trip (500k Max - 1 person)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 31    ///////
                                                        /////////////////////////
                                                        //Level 3 - Line 65536
                                                        Pay31 = (Pay30 * 4) + 1;
                                                        PayAmt31 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "25000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Car max 4M, Trip 2(500k x 1 person)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay31);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 8");//Trip 2(500k Max - 2 people)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 32    //////
                                                        /////////////////////////
                                                        //Level 4 - Line 262144
                                                        Pay32 = (Pay31 * 4) + 1;
                                                        PayAmt32 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "50000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Jeep max 10M, Trip 2(500k Max x 2 people)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay32);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 9");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 33    //////
                                                        /////////////////////////
                                                        //Level 5 - Line 1048576
                                                        Pay33 = (Pay32 * 4) + 1;
                                                        PayAmt33 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//House Fund (15M max)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay33);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 10");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();

                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacement(referralid,placementid,referralname,placementname,userid,useridname,username,assignedsn,datereg,programid,dd,mm,yy) values (@referralid,@placementid,@referralname,@placementname,@userid,@useridname,@username,@assignedsn,@datereg,@programid,@dd,@mm,@yy)", con))
                                                        {//referralid,placementid,referralname,placementname,idplacetrack,datereg,dd,mm,yy
                                                            //Generate Email Code
                                                            cmd.Parameters.AddWithValue("@referralid", referralID);
                                                            cmd.Parameters.AddWithValue("@placementid", referralID);
                                                            cmd.Parameters.AddWithValue("@referralname", referralname);
                                                            cmd.Parameters.AddWithValue("@placementname", referralname);
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //Update Wallet balance
                                                        using (cmd = new SqlCommand("Update crcitizensfundwallet set amount=@amount where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@amount", newAmount);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //Section of 4 operations
                                                        //1. Add the codes for referral commissions
                                                        //2. Add the codes for registration bonus
                                                        //3. Add the codes for CBPV points Referrer - ReferrerID'
                                                        //4. Add codes for APV
                                                        //5. Add the codes for the profit or retained earnings for the company.
                                                        #region 1. Add the codes for referral commissions
                                                        //Save Referral Commissions

                                                        //Level 1 commissions
                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                            cmd.Parameters.AddWithValue("amount", 1100);//22%
                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();

                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                cmd.Parameters.AddWithValue("@rank", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@amountdue", 1100);//22%
                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                cmd.Parameters.AddWithValue("@reason", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                cmd.ExecuteNonQuery();
                                                            }
                                                            //referralID = "3bb71M9C";
                                                            //Level 2 Commissions
                                                            string Level2ID = referralID;
                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                            {
                                                                cmd.Parameters.AddWithValue("@userid", Level2ID);
                                                                using (dr = cmd.ExecuteReader())
                                                                {
                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                    {
                                                                        referralID = dr.GetValue(0).ToString();

                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                            cmd.Parameters.AddWithValue("amount", 500);//10%
                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                            dr.Dispose();
                                                                            cmd.ExecuteNonQuery();

                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                cmd.Parameters.AddWithValue("@rank", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@amountdue", 500);//10%
                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                cmd.Parameters.AddWithValue("@reason", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                cmd.ExecuteNonQuery();
                                                                            }


                                                                            dr.Dispose();
                                                                            //Level 3 Commissions
                                                                            string Level3ID = referralID;
                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                            {
                                                                                cmd.Parameters.AddWithValue("@userid", Level3ID);
                                                                                using (dr = cmd.ExecuteReader())
                                                                                {
                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                    {
                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                            cmd.Parameters.AddWithValue("amount", 250);//5%
                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                            dr.Dispose();
                                                                                            cmd.ExecuteNonQuery();

                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                cmd.Parameters.AddWithValue("@rank", "3rd Level Referral Bonus from " + UserId);
                                                                                                cmd.Parameters.AddWithValue("@amountdue", 250);//5%
                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                cmd.Parameters.AddWithValue("@reason", "3rd Level Referral Bonus from " + UserId);
                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                cmd.ExecuteNonQuery();
                                                                                            }
                                                                                        }
                                                                                        dr.Dispose();
                                                                                        //Level 4 Commissions
                                                                                        string Level4ID = referralID;
                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                        {
                                                                                            cmd.Parameters.AddWithValue("@userid", Level4ID);
                                                                                            using (dr = cmd.ExecuteReader())
                                                                                            {
                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                {
                                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                        cmd.Parameters.AddWithValue("amount", 100);//2%
                                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                                        dr.Dispose();
                                                                                                        cmd.ExecuteNonQuery();

                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                            cmd.Parameters.AddWithValue("@rank", "4th Level Referral Bonus from " + UserId);
                                                                                                            cmd.Parameters.AddWithValue("@amountdue", 100);//2%
                                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                                            cmd.Parameters.AddWithValue("@reason", "4th Level Referral Bonus from " + UserId);
                                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                            cmd.ExecuteNonQuery();
                                                                                                        }
                                                                                                    }

                                                                                                    dr.Dispose();
                                                                                                    //Level 5 Commissions
                                                                                                    string Level5ID = referralID;
                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                    {
                                                                                                        cmd.Parameters.AddWithValue("@userid", Level5ID);
                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                        {
                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                            {
                                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                    cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                    dr.Dispose();
                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                        cmd.Parameters.AddWithValue("@rank", "5th Level Referral Bonus from " + UserId);
                                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                        cmd.Parameters.AddWithValue("@reason", "5th Level Referral Bonus from " + UserId);
                                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                    }
                                                                                                                }

                                                                                                                dr.Dispose();
                                                                                                                //Level 6 Commissions
                                                                                                                string Level6ID = referralID;
                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                {
                                                                                                                    cmd.Parameters.AddWithValue("@userid", Level6ID);
                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                    {
                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                        {
                                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                dr.Dispose();
                                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                    cmd.Parameters.AddWithValue("@rank", "6th Level Referral Bonus from " + UserId);
                                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                    cmd.Parameters.AddWithValue("@reason", "6th Level Referral Bonus from " + UserId);
                                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                }
                                                                                                                            }

                                                                                                                            dr.Dispose();
                                                                                                                            //Level 7 Commissions
                                                                                                                            string Level7ID = referralID;
                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                            {
                                                                                                                                cmd.Parameters.AddWithValue("@userid", Level7ID);
                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                {
                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                    {
                                                                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                            cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                            dr.Dispose();
                                                                                                                                            cmd.ExecuteNonQuery();

                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                cmd.Parameters.AddWithValue("@rank", "7th Level Referral Bonus from " + UserId);
                                                                                                                                                cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                cmd.Parameters.AddWithValue("@reason", "7th Level Referral Bonus from " + UserId);
                                                                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                        dr.Dispose();
                                                                                                                                        //Level 8 Commissions
                                                                                                                                        string Level8ID = referralID;
                                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                        {
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", Level8ID);
                                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                                            {
                                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                {
                                                                                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                        cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                        dr.Dispose();
                                                                                                                                                        cmd.ExecuteNonQuery();

                                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                            cmd.Parameters.AddWithValue("@rank", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                            cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                            cmd.Parameters.AddWithValue("@reason", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                                        }
                                                                                                                                                    }

                                                                                                                                                    dr.Dispose();
                                                                                                                                                    //Level 9 Commissions
                                                                                                                                                    string Level9ID = referralID;
                                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                    {
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", Level9ID);
                                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                                        {
                                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                            {
                                                                                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                    cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                    dr.Dispose();
                                                                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@rank", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                        cmd.Parameters.AddWithValue("@reason", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                                    }
                                                                                                                                                                }

                                                                                                                                                                dr.Dispose();
                                                                                                                                                                //Level 10 Commissions
                                                                                                                                                                string Level10ID = referralID;
                                                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                                {
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", Level10ID);
                                                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                                                    {
                                                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                        {
                                                                                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                                dr.Dispose();
                                                                                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@rank", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@reason", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                                                                }
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion

                                                        #region 2. Add the codes for registration bonus
                                                        //do a loop selection till it get to 10 levels above that is 10 levels deep
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Registration Bonus");
                                                            cmd.Parameters.AddWithValue("@amountdue", 1000);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Registration Bonus");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        #endregion

                                                        #region 3. Add the codes for CBPV(ConnectRecharge Points Value) & Corresponding Earnings - ReferrerID
                                                        //Earnings Codes for CBPVs

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(payassignedsn) from CRCitizensPlacementPay where payassignedsn=@assignedsn", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    double count = double.Parse(dr.GetValue(0).ToString());
                                                                    #region Counter > 1
                                                                    if (count > 1)
                                                                    {
                                                                        dr.Dispose();
                                                                        //use a loop to insert into earnings

                                                                        using (da = new SqlDataAdapter())
                                                                        {
                                                                            //, con
                                                                            DataSet ds = new DataSet();
                                                                            int ii = 0;
                                                                            string sql = null;
                                                                            sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                            using (cmd = new SqlCommand(sql, con))
                                                                            {
                                                                                da.SelectCommand = cmd;
                                                                                da.SelectCommand.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                                dr.Dispose();
                                                                                da.Fill(ds);
                                                                                for (ii = 0; ii <= ds.Tables[0].Rows.Count - 1; ii++)
                                                                                {
                                                                                    //countLine = 1;
                                                                                    string id = ds.Tables[0].Rows[ii].ItemArray[0].ToString();
                                                                                    string idname = ds.Tables[0].Rows[ii].ItemArray[1].ToString();
                                                                                    string paylevel = ds.Tables[0].Rows[ii].ItemArray[2].ToString();
                                                                                    string programid = ds.Tables[0].Rows[ii].ItemArray[3].ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                    #region Counter == 1
                                                                    else if (count == 1)
                                                                    {
                                                                        dr.Dispose();
                                                                        string sql = null;
                                                                        sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                        using (cmd = new SqlCommand(sql, con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    string id = dr.GetValue(0).ToString();
                                                                                    string idname = dr.GetValue(1).ToString();
                                                                                    string paylevel = dr.GetValue(2).ToString();
                                                                                    string programid = dr.GetValue(3).ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                }
                                                            }
                                                        }

                                                        #endregion

                                                        #region  4. Add APV Points
                                                        //Write codes to add APV points automatically
                                                        //Determine if eligible for APV points by checking if up to 10 citizens have been referred by them
                                                        dr.Dispose();
                                                        //Level 1
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 1);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 2
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 2);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 2);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 3
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 3);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 3);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 4);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 4);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //5
                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 5);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 5);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //6
                                                        //Level 6
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 6);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 6);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //7
                                                        //Level 7
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 7);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //8
                                                        //Level 8
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 8);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //9
                                                        //Level 9
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 9);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 9);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //10
                                                        //Level 10
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 10);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 10);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }


                                                        #endregion

                                                        #region 5. Retained earnings/profits per registration
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select registrations from crprofitearnings", con))
                                                        {
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    int regCount = int.Parse(dr.GetValue(0).ToString());
                                                                    int NewregCount = regCount + 1;
                                                                    int NewAmount = NewregCount * 33;

                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update crprofitearnings set registrations=@register,amount=@amount,total=@total", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@register", NewregCount);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", NewAmount);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into crprofitearnings(registrations,amount,total) values (@registrations,@amount,@total)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@registrations", 1);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", 33);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion


                                                        #endregion

                                                    }
                                                    else if (AutoAccounts == 1)
                                                    {
                                                        #region Auto & Normal Accounts creation



                                                        //Auto Account
                                                        #region 1-Auto Account
                                                        string NewUserId = UserId;
                                                        string NewUserIdName = useridname;


                                                        UserId = "2bb71M9C";
                                                        useridname = "Emmanuel Ogbewele";

                                                        int yourRandomStringLengthIDx = 8; //maximum: 32 
                                                        programID = Guid.NewGuid().ToString("N").Substring(0, yourRandomStringLengthIDx);

                                                        double firstLinePlacement = (AssignedSN * 4) + 1;
                                                        dr.Dispose();
                                                        //Cycle1 - Line 1 // Line 4 <-- No Payment
                                                        //
                                                        //


                                                        //Cycle 0 (First line payment) // Line 4
                                                        //////////////////////////
                                                        //////    Pay 0    ///////
                                                        /////////////////////////
                                                        Pay0 = firstLinePlacement;
                                                        PayAmt0 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay0);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 1");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //Cycle 1 (pay only Line 2) // Line 16
                                                        //////////////////////////
                                                        //////    Pay 4    ///////
                                                        /////////////////////////
                                                        Pay4 = (firstLinePlacement * 4) + 1;
                                                        PayAmt4 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay4);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 3    ///////
                                                        /////////////////////////
                                                        Pay3 = Pay4 - 4;
                                                        PayAmt3 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay3);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 2    ///////
                                                        /////////////////////////
                                                        Pay2 = Pay3 - 4;
                                                        PayAmt2 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay2);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 1    ///////
                                                        /////////////////////////
                                                        Pay1 = Pay2 - 4;
                                                        PayAmt1 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay1);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////

                                                        //CYcle 2 - Line 1 // Line 64
                                                        //////////////////////////
                                                        //////    Pay 8    ///////
                                                        /////////////////////////
                                                        Pay8 = (Pay4 * 4) + 1;
                                                        PayAmt8 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay8);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 7    ///////
                                                        /////////////////////////
                                                        Pay7 = Pay8 - 16;
                                                        PayAmt7 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay7);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 6    ///////
                                                        /////////////////////////
                                                        Pay6 = Pay7 - 16;
                                                        PayAmt6 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay6);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 5    ///////
                                                        /////////////////////////
                                                        Pay5 = Pay6 - 16;
                                                        PayAmt5 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay5);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////


                                                        //Cycle 2 - Line 2 // Line 256 

                                                        ///////////////////////////
                                                        //////    Pay 24    //////
                                                        /////////////////////////
                                                        Pay24 = (Pay8 * 4) + 1;
                                                        PayAmt24 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay24);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 23    //////
                                                        /////////////////////////
                                                        Pay23 = Pay24 - 16;
                                                        PayAmt23 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay23);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 22    //////
                                                        /////////////////////////
                                                        Pay22 = Pay23 - 16;
                                                        PayAmt22 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay22);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 21    //////
                                                        /////////////////////////
                                                        Pay21 = Pay22 - 16;
                                                        PayAmt21 = 7500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay21);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 20    //////
                                                        /////////////////////////
                                                        Pay20 = Pay21 - 16;
                                                        PayAmt20 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay20);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 19    //////
                                                        /////////////////////////
                                                        Pay19 = Pay20 - 16;
                                                        PayAmt19 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay19);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 18    //////
                                                        /////////////////////////
                                                        Pay18 = Pay19 - 16;
                                                        PayAmt18 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay18);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 17    //////
                                                        /////////////////////////
                                                        Pay17 = Pay18 - 16;
                                                        PayAmt17 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay17);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 16    //////
                                                        /////////////////////////
                                                        Pay16 = Pay17 - 16;
                                                        PayAmt16 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay16);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 15    //////
                                                        /////////////////////////
                                                        Pay15 = Pay16 - 16;
                                                        PayAmt15 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay15);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 14    //////
                                                        /////////////////////////
                                                        Pay14 = Pay15 - 16;
                                                        PayAmt14 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay14);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 13    //////
                                                        /////////////////////////
                                                        Pay13 = Pay14 - 16;
                                                        PayAmt13 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay13);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 12    //////
                                                        /////////////////////////
                                                        Pay12 = Pay13 - 16;
                                                        PayAmt12 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay12);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 11    ///////
                                                        /////////////////////////
                                                        Pay11 = Pay12 - 16;
                                                        PayAmt11 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay11);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay10 = Pay11 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay10);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay9 = Pay10 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay9);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }


                                                        ///////////////////////////////////////////////////////////////

                                                        //(Pay Only Line 1) Line 1024

                                                        //////////////////////////
                                                        //////    Pay 28    ///////
                                                        /////////////////////////
                                                        Pay28 = (Pay24 * 4) + 1;
                                                        PayAmt28 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "3000CBPV");//Smart Phone
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay28);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 5");//Smart Phone(30k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        ///////////////////////////////////////////////////////////////

                                                        ///////////////////////////////////////////////////////////////

                                                        /////////////////////////////////////
                                                        //         Level 1-Line 4096      //
                                                        ////////////////////////////////////

                                                        ////////////////////////////
                                                        ////////    Pay 29    ///////
                                                        ///////////////////////////
                                                        Pay29 = (Pay28 * 4) + 1;
                                                        PayAmt29 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "6000CBPV");//Tablet
                                                            cmd.Parameters.AddWithValue("@payamount", 0);
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay29);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 6");//Smart Tab(60k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 30    ///////
                                                        /////////////////////////
                                                        //Level 2 - Line 16384
                                                        Pay30 = (Pay29 * 4) + 1;
                                                        PayAmt30 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "12000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//Dubai Trip
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay30);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 7");//Dubai Trip (500k Max - 1 person)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 31    ///////
                                                        /////////////////////////
                                                        //Level 3 - Line 65536
                                                        Pay31 = (Pay30 * 4) + 1;
                                                        PayAmt31 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "25000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Car max 4M, Trip 2(500k x 1 person)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay31);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 8");//Trip 2(500k Max - 2 people)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 32    //////
                                                        /////////////////////////
                                                        //Level 4 - Line 262144
                                                        Pay32 = (Pay31 * 4) + 1;
                                                        PayAmt32 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "50000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Jeep max 10M, Trip 2(500k Max x 2 people)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay32);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 9");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 33    //////
                                                        /////////////////////////
                                                        //Level 5 - Line 1048576
                                                        Pay33 = (Pay32 * 4) + 1;
                                                        PayAmt33 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//House Fund (15M max)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay33);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 10");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();

                                                        }

                                                        string NEWreferralID = referralID;
                                                        string NEWplacementid = placementid;
                                                        string NEWreferralname = referralname;
                                                        string NEWplacementname = placementname;

                                                        referralID = "2bb71M9C";
                                                        placementid = "2bb71M9C";
                                                        referralname = "Emmanuel Ogbewele";
                                                        placementname = "Emmanuel Ogbewele";
                                                        //Placement code completion
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacement(referralid,placementid,referralname,placementname,userid,useridname,username,assignedsn,datereg,programid,dd,mm,yy) values (@referralid,@placementid,@referralname,@placementname,@userid,@useridname,@username,@assignedsn,@datereg,@programid,@dd,@mm,@yy)", con))
                                                        {//referralid,placementid,referralname,placementname,idplacetrack,datereg,dd,mm,yy
                                                            //Generate Email Code
                                                            cmd.Parameters.AddWithValue("@referralid", referralID);
                                                            cmd.Parameters.AddWithValue("@placementid", referralID);
                                                            cmd.Parameters.AddWithValue("@referralname", referralname);
                                                            cmd.Parameters.AddWithValue("@placementname", referralname);
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();
                                                        }



                                                        //Section of 4 operations
                                                        //1. Add the codes for referral commissions
                                                        //2. Add the codes for registration bonus
                                                        //3. Add the codes for CBPV points Referrer - ReferrerID'
                                                        //4. Add codes for APV
                                                        //5. Add the codes for the profit or retained earnings for the company.
                                                        #region 1. Add the codes for referral commissions
                                                        //Save Referral Commissions

                                                        //Level 1 commissions
                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                            cmd.Parameters.AddWithValue("amount", 1100);//22%
                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();

                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                cmd.Parameters.AddWithValue("@rank", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@amountdue", 1100);//22%
                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                cmd.Parameters.AddWithValue("@reason", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                cmd.ExecuteNonQuery();
                                                            }

                                                            //Level 2 Commissions
                                                            string Level2ID = referralID;
                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                            {
                                                                cmd.Parameters.AddWithValue("@userid", Level2ID);
                                                                using (dr = cmd.ExecuteReader())
                                                                {
                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                    {
                                                                        referralID = dr.GetValue(0).ToString();

                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                            cmd.Parameters.AddWithValue("amount", 500);//10%
                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                            dr.Dispose();
                                                                            cmd.ExecuteNonQuery();

                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                cmd.Parameters.AddWithValue("@rank", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@amountdue", 500);//10%
                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                cmd.Parameters.AddWithValue("@reason", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                cmd.ExecuteNonQuery();
                                                                            }
                                                                        }

                                                                        dr.Dispose();
                                                                        //Level 3 Commissions
                                                                        string Level3ID = referralID;
                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", Level3ID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                        cmd.Parameters.AddWithValue("amount", 250);//5%
                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                        dr.Dispose();
                                                                                        cmd.ExecuteNonQuery();

                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                            cmd.Parameters.AddWithValue("@rank", "3rd Level Referral Bonus from " + UserId);
                                                                                            cmd.Parameters.AddWithValue("@amountdue", 250);//5%
                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                            cmd.Parameters.AddWithValue("@reason", "3rd Level Referral Bonus from " + UserId);
                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                            cmd.ExecuteNonQuery();
                                                                                        }
                                                                                    }
                                                                                    dr.Dispose();
                                                                                    //Level 4 Commissions
                                                                                    string Level4ID = referralID;
                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", Level4ID);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                    cmd.Parameters.AddWithValue("amount", 100);//2%
                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                    dr.Dispose();
                                                                                                    cmd.ExecuteNonQuery();

                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                        cmd.Parameters.AddWithValue("@rank", "4th Level Referral Bonus from " + UserId);
                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 100);//2%
                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                        cmd.Parameters.AddWithValue("@reason", "4th Level Referral Bonus from " + UserId);
                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                        cmd.ExecuteNonQuery();
                                                                                                    }
                                                                                                }

                                                                                                dr.Dispose();
                                                                                                //Level 5 Commissions
                                                                                                string Level5ID = referralID;
                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", Level5ID);
                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                    {
                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                        {
                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                dr.Dispose();
                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                    cmd.Parameters.AddWithValue("@rank", "5th Level Referral Bonus from " + UserId);
                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                    cmd.Parameters.AddWithValue("@reason", "5th Level Referral Bonus from " + UserId);
                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                }
                                                                                                            }

                                                                                                            dr.Dispose();
                                                                                                            //Level 6 Commissions
                                                                                                            string Level6ID = referralID;
                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                            {
                                                                                                                cmd.Parameters.AddWithValue("@userid", Level6ID);
                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                {
                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                    {
                                                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                            cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                            dr.Dispose();
                                                                                                                            cmd.ExecuteNonQuery();

                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                cmd.Parameters.AddWithValue("@rank", "6th Level Referral Bonus from " + UserId);
                                                                                                                                cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                cmd.Parameters.AddWithValue("@reason", "6th Level Referral Bonus from " + UserId);
                                                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                            }
                                                                                                                        }

                                                                                                                        dr.Dispose();
                                                                                                                        //Level 6 Commissions
                                                                                                                        string Level7ID = referralID;
                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                        {
                                                                                                                            cmd.Parameters.AddWithValue("@userid", Level7ID);
                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                            {
                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                {
                                                                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                        cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                        dr.Dispose();
                                                                                                                                        cmd.ExecuteNonQuery();

                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                            cmd.Parameters.AddWithValue("@rank", "7th Level Referral Bonus from " + UserId);
                                                                                                                                            cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                            cmd.Parameters.AddWithValue("@reason", "7th Level Referral Bonus from " + UserId);
                                                                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    dr.Dispose();
                                                                                                                                    //Level 8 Commissions
                                                                                                                                    string Level8ID = referralID;
                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                    {
                                                                                                                                        cmd.Parameters.AddWithValue("@userid", Level8ID);
                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                        {
                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                            {
                                                                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                    cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                    dr.Dispose();
                                                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                        cmd.Parameters.AddWithValue("@rank", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                        cmd.Parameters.AddWithValue("@reason", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                    }
                                                                                                                                                }

                                                                                                                                                dr.Dispose();
                                                                                                                                                //Level 6 Commissions
                                                                                                                                                string Level9ID = referralID;
                                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                {
                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", Level9ID);
                                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                                    {
                                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                        {
                                                                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                dr.Dispose();
                                                                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@rank", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                    cmd.Parameters.AddWithValue("@reason", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                                                }
                                                                                                                                                            }

                                                                                                                                                            dr.Dispose();
                                                                                                                                                            //Level 6 Commissions
                                                                                                                                                            string Level10ID = referralID;
                                                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                            {
                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", Level10ID);
                                                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                                                {
                                                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                    {
                                                                                                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                            cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                            dr.Dispose();
                                                                                                                                                                            cmd.ExecuteNonQuery();

                                                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@rank", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                                cmd.Parameters.AddWithValue("@reason", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion

                                                        // No 2. Registration Bonus //None for Auto Accounts

                                                        #region 3. Add the codes for CBPV(ConnectRecharge Points Value) & Corresponding Earnings - ReferrerID
                                                        //Earnings Codes for CBPVs

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(payassignedsn) from CRCitizensPlacementPay where payassignedsn=@assignedsn", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    double count = double.Parse(dr.GetValue(0).ToString());
                                                                    #region Counter > 1
                                                                    if (count > 1)
                                                                    {
                                                                        dr.Dispose();
                                                                        //use a loop to insert into earnings

                                                                        using (da = new SqlDataAdapter())
                                                                        {
                                                                            //, con
                                                                            DataSet ds = new DataSet();
                                                                            int ii = 0;
                                                                            string sql = null;
                                                                            sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                            using (cmd = new SqlCommand(sql, con))
                                                                            {
                                                                                da.SelectCommand = cmd;
                                                                                da.SelectCommand.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                                dr.Dispose();
                                                                                da.Fill(ds);
                                                                                for (ii = 0; ii <= ds.Tables[0].Rows.Count - 1; ii++)
                                                                                {
                                                                                    //countLine = 1;
                                                                                    string id = ds.Tables[0].Rows[ii].ItemArray[0].ToString();
                                                                                    string idname = ds.Tables[0].Rows[ii].ItemArray[1].ToString();
                                                                                    string paylevel = ds.Tables[0].Rows[ii].ItemArray[2].ToString();
                                                                                    string programid = ds.Tables[0].Rows[ii].ItemArray[3].ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                    #region Counter == 1
                                                                    else if (count == 1)
                                                                    {
                                                                        string sql = null;
                                                                        sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                        using (cmd = new SqlCommand(sql, con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    string id = dr.GetValue(0).ToString();
                                                                                    string idname = dr.GetValue(1).ToString();
                                                                                    string paylevel = dr.GetValue(2).ToString();
                                                                                    string programid = dr.GetValue(3).ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                }
                                                            }
                                                        }

                                                        #endregion



                                                        #region  4. Add APV Points
                                                        //Write codes to add APV points automatically
                                                        //Determine if eligible for APV points by checking if up to 10 citizens have been referred by them
                                                        dr.Dispose();
                                                        //Level 1
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 1);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 2
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 2);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 2);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 3
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 3);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 3);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 4);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 4);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //5
                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 5);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 5);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //6
                                                        //Level 6
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 6);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 6);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //7
                                                        //Level 7
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 7);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //8
                                                        //Level 8
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 8);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //9
                                                        //Level 9
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 9);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 9);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //10
                                                        //Level 10
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 10);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 10);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }


                                                        #endregion


                                                        #region 5. Retained earnings/profits per registration
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(registrations) from crprofitearnings", con))
                                                        {
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    int regCount = int.Parse(dr.GetValue(0).ToString());
                                                                    int NewregCount = regCount + 1;
                                                                    int NewAmount = NewregCount * 33;

                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update crprofitearnings set registrations=@register,amount=@amount,total=@total", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@register", NewregCount);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", NewAmount);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into crprofitearnings(registrations,amount,total) values (@registrations,@amount,@total)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@registrations", 1);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", 33);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion
                                                        #endregion



                                                        //Normal Account
                                                        #region 2-Normal Account
                                                        //Normal Account
                                                        UserId = NewUserId;
                                                        useridname = NewUserIdName;

                                                        AssignedSN = AssignedSN + 1;
                                                        int yourRandomStringLengthIDy = 8; //maximum: 32 
                                                        programID = Guid.NewGuid().ToString("N").Substring(0, yourRandomStringLengthIDy);

                                                        double firstLinePlacementy = (AssignedSN * 4) + 1;
                                                        dr.Dispose();
                                                        //Cycle1 - Line 1 // Line 4 <-- No Payment
                                                        //
                                                        //


                                                        //Cycle 0 (First line payment) // Line 4
                                                        //////////////////////////
                                                        //////    Pay 0    ///////
                                                        /////////////////////////
                                                        Pay0 = firstLinePlacement;
                                                        PayAmt0 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay0);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 1");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //Cycle 1 (pay only Line 2) // Line 16
                                                        //////////////////////////
                                                        //////    Pay 4    ///////
                                                        /////////////////////////
                                                        Pay4 = (firstLinePlacement * 4) + 1;
                                                        PayAmt4 = 500;

                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay4);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 3    ///////
                                                        /////////////////////////
                                                        Pay3 = Pay4 - 4;
                                                        PayAmt3 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay3);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 2    ///////
                                                        /////////////////////////
                                                        Pay2 = Pay3 - 4;
                                                        PayAmt2 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay2);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 1    ///////
                                                        /////////////////////////
                                                        Pay1 = Pay2 - 4;
                                                        PayAmt1 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay1);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 2");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////

                                                        //CYcle 2 - Line 1 // Line 64
                                                        //////////////////////////
                                                        //////    Pay 8    ///////
                                                        /////////////////////////
                                                        Pay8 = (Pay4 * 4) + 1;
                                                        PayAmt8 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay8);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 7    ///////
                                                        /////////////////////////
                                                        Pay7 = Pay8 - 16;
                                                        PayAmt7 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay7);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 6    ///////
                                                        /////////////////////////
                                                        Pay6 = Pay7 - 16;
                                                        PayAmt6 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay6);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////
                                                        //////    Pay 5    ///////
                                                        /////////////////////////
                                                        Pay5 = Pay6 - 16;
                                                        PayAmt5 = 1000;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "200CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 1000);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay5);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 3");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        //////////////////////////////////////////////////////


                                                        //Cycle 2 - Line 2 // Line 256 

                                                        ///////////////////////////
                                                        //////    Pay 24    //////
                                                        /////////////////////////
                                                        Pay24 = (Pay8 * 4) + 1;
                                                        PayAmt24 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay24);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 23    //////
                                                        /////////////////////////
                                                        Pay23 = Pay24 - 16;
                                                        PayAmt23 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay23);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 22    //////
                                                        /////////////////////////
                                                        Pay22 = Pay23 - 16;
                                                        PayAmt22 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay22);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 21    //////
                                                        /////////////////////////
                                                        Pay21 = Pay22 - 16;
                                                        PayAmt21 = 7500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay21);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 20    //////
                                                        /////////////////////////
                                                        Pay20 = Pay21 - 16;
                                                        PayAmt20 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay20);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 19    //////
                                                        /////////////////////////
                                                        Pay19 = Pay20 - 16;
                                                        PayAmt19 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay19);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 18    //////
                                                        /////////////////////////
                                                        Pay18 = Pay19 - 16;
                                                        PayAmt18 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay18);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 17    //////
                                                        /////////////////////////
                                                        Pay17 = Pay18 - 16;
                                                        PayAmt17 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay17);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 16    //////
                                                        /////////////////////////
                                                        Pay16 = Pay17 - 16;
                                                        PayAmt16 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay16);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 15    //////
                                                        /////////////////////////
                                                        Pay15 = Pay16 - 16;
                                                        PayAmt15 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay15);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 14    //////
                                                        /////////////////////////
                                                        Pay14 = Pay15 - 16;
                                                        PayAmt14 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay14);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 13    //////
                                                        /////////////////////////
                                                        Pay13 = Pay14 - 16;
                                                        PayAmt13 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay13);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        ///////////////////////////
                                                        //////    Pay 12    //////
                                                        /////////////////////////
                                                        Pay12 = Pay13 - 16;
                                                        PayAmt12 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay12);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 11    ///////
                                                        /////////////////////////
                                                        Pay11 = Pay12 - 16;
                                                        PayAmt11 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay11);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay10 = Pay11 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay10);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 10    //////
                                                        /////////////////////////
                                                        Pay9 = Pay10 - 16;
                                                        PayAmt10 = 500;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "93.75CBPV");
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 500);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay9);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 4");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }


                                                        ///////////////////////////////////////////////////////////////

                                                        //(Pay Only Line 1) Line 1024

                                                        //////////////////////////
                                                        //////    Pay 28    //////
                                                        /////////////////////////
                                                        Pay28 = (Pay24 * 4) + 1;
                                                        PayAmt28 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "3000CBPV");//Smart Phone
                                                            if (currency == "NGN")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            else if (currency == "USD")
                                                            {
                                                                cmd.Parameters.AddWithValue("@payamount", 0);
                                                            }
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay28);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 5");//Smart Phone(30k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                        ///////////////////////////////////////////////////////////////

                                                        ///////////////////////////////////////////////////////////////

                                                        /////////////////////////////////////
                                                        //         Level 1-Line 4096      //
                                                        ////////////////////////////////////

                                                        ////////////////////////////
                                                        ////////    Pay 29    ///////
                                                        ///////////////////////////
                                                        Pay29 = (Pay28 * 4) + 1;
                                                        PayAmt29 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "6000CBPV");//Tablet
                                                            cmd.Parameters.AddWithValue("@payamount", 0);
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay29);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 6");//Smart Tab(60k Max)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 30    ///////
                                                        /////////////////////////
                                                        //Level 2 - Line 16384
                                                        Pay30 = (Pay29 * 4) + 1;
                                                        PayAmt30 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "12000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//Dubai Trip
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay30);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 7");//Dubai Trip (500k Max - 1 person)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 31    ///////
                                                        /////////////////////////
                                                        //Level 3 - Line 65536
                                                        Pay31 = (Pay30 * 4) + 1;
                                                        PayAmt31 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "25000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Car max 4M, Trip 2(500k x 1 person)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay31);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 8");//Trip 2(500k Max - 2 people)
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 32    //////
                                                        /////////////////////////
                                                        //Level 4 - Line 262144
                                                        Pay32 = (Pay31 * 4) + 1;
                                                        PayAmt32 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "50000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//(Jeep max 10M, Trip 2(500k Max x 2 people)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay32);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 9");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //////////////////////////
                                                        //////    Pay 33    //////
                                                        /////////////////////////
                                                        //Level 5 - Line 1048576
                                                        Pay33 = (Pay32 * 4) + 1;
                                                        PayAmt33 = 0;
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacementPay (userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid) values (@userid,@useridname,@assignedsn,@paylevel,@payamount,@payassignedsn,@datereg,@dd,@mm,@yy,@rank,@programid)", con))
                                                        {//userid,useridname,assignedsn,paylevel,payamount,datereg,dd,mm,yy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@paylevel", "100000CBPV");
                                                            cmd.Parameters.AddWithValue("@payamount", 0);//House Fund (20M max)
                                                            cmd.Parameters.AddWithValue("@payassignedsn", Pay33);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@rank", "CR 10");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }


                                                        referralID = NEWreferralID;
                                                        placementid = NEWplacementid;
                                                        referralname = NEWreferralname;
                                                        placementname = NEWplacementname;
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Insert into CRCitizensPlacement(referralid,placementid,referralname,placementname,userid,useridname,username,assignedsn,datereg,programid,dd,mm,yy) values (@referralid,@placementid,@referralname,@placementname,@userid,@useridname,@username,@assignedsn,@datereg,@programid,@dd,@mm,@yy)", con))
                                                        {//referralid,placementid,referralname,placementname,idplacetrack,datereg,dd,mm,yy
                                                            //Generate Email Code
                                                            cmd.Parameters.AddWithValue("@referralid", referralID);
                                                            cmd.Parameters.AddWithValue("@placementid", referralID);
                                                            cmd.Parameters.AddWithValue("@referralname", referralname);
                                                            cmd.Parameters.AddWithValue("@placementname", referralname);
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@useridname", useridname);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            cmd.Parameters.AddWithValue("@datereg", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //Update Wallet balance
                                                        using (cmd = new SqlCommand("Update crcitizensfundwallet set amount=@amount where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@amount", newAmount);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        //Section of 4 operations
                                                        //1. Add the codes for referral commissions
                                                        //2. Add the codes for registration bonus
                                                        //3. Add the codes for CBPV points Referrer - ReferrerID'
                                                        //4. Add codes for APV
                                                        //5. Add the codes for the profit or retained earnings for the company.
                                                        #region 1. Add the codes for referral commissions
                                                        //Save Referral Commissions

                                                        //Level 1 commissions
                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                            cmd.Parameters.AddWithValue("amount", 1100);//22%
                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                            dr.Dispose();
                                                            cmd.ExecuteNonQuery();

                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                cmd.Parameters.AddWithValue("@rank", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@amountdue", 1100);//22%
                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                cmd.Parameters.AddWithValue("@reason", "1st level Referral Bonus for " + UserId);
                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                cmd.ExecuteNonQuery();
                                                            }

                                                            //Level 2 Commissions
                                                            string Level2ID = referralID;
                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                            {
                                                                cmd.Parameters.AddWithValue("@userid", Level2ID);
                                                                using (dr = cmd.ExecuteReader())
                                                                {
                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                    {
                                                                        referralID = dr.GetValue(0).ToString();

                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                            cmd.Parameters.AddWithValue("amount", 500);//10%
                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                            dr.Dispose();
                                                                            cmd.ExecuteNonQuery();

                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                            { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                cmd.Parameters.AddWithValue("@rank", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@amountdue", 500);//10%
                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                cmd.Parameters.AddWithValue("@reason", "2nd Level Referral Bonus from " + UserId);
                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                cmd.ExecuteNonQuery();
                                                                            }
                                                                        }

                                                                        dr.Dispose();
                                                                        //Level 3 Commissions
                                                                        string Level3ID = referralID;
                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", Level3ID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                        cmd.Parameters.AddWithValue("amount", 250);//5%
                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                        dr.Dispose();
                                                                                        cmd.ExecuteNonQuery();

                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                            cmd.Parameters.AddWithValue("@rank", "3rd Level Referral Bonus from " + UserId);
                                                                                            cmd.Parameters.AddWithValue("@amountdue", 250);//5%
                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                            cmd.Parameters.AddWithValue("@reason", "3rd Level Referral Bonus from " + UserId);
                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                            cmd.ExecuteNonQuery();
                                                                                        }
                                                                                    }
                                                                                    dr.Dispose();
                                                                                    //Level 4 Commissions
                                                                                    string Level4ID = referralID;
                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", Level4ID);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                    cmd.Parameters.AddWithValue("amount", 100);//2%
                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                    dr.Dispose();
                                                                                                    cmd.ExecuteNonQuery();

                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                        cmd.Parameters.AddWithValue("@rank", "4th Level Referral Bonus from " + UserId);
                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 100);//2%
                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                        cmd.Parameters.AddWithValue("@reason", "4th Level Referral Bonus from " + UserId);
                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                        cmd.ExecuteNonQuery();
                                                                                                    }
                                                                                                }

                                                                                                dr.Dispose();
                                                                                                //Level 5 Commissions
                                                                                                string Level5ID = referralID;
                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", Level5ID);
                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                    {
                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                        {
                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                dr.Dispose();
                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                    cmd.Parameters.AddWithValue("@rank", "5th Level Referral Bonus from " + UserId);
                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                    cmd.Parameters.AddWithValue("@reason", "5th Level Referral Bonus from " + UserId);
                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                }
                                                                                                            }

                                                                                                            dr.Dispose();
                                                                                                            //Level 6 Commissions
                                                                                                            string Level6ID = referralID;
                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                            {
                                                                                                                cmd.Parameters.AddWithValue("@userid", Level6ID);
                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                {
                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                    {
                                                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                            cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                            dr.Dispose();
                                                                                                                            cmd.ExecuteNonQuery();

                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                cmd.Parameters.AddWithValue("@rank", "6th Level Referral Bonus from " + UserId);
                                                                                                                                cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                cmd.Parameters.AddWithValue("@reason", "6th Level Referral Bonus from " + UserId);
                                                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                            }
                                                                                                                        }

                                                                                                                        dr.Dispose();
                                                                                                                        //Level 6 Commissions
                                                                                                                        string Level7ID = referralID;
                                                                                                                        using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                        {
                                                                                                                            cmd.Parameters.AddWithValue("@userid", Level7ID);
                                                                                                                            using (dr = cmd.ExecuteReader())
                                                                                                                            {
                                                                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                {
                                                                                                                                    referralID = dr.GetValue(0).ToString();

                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                    {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                        cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                        cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                        cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                        cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                        cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                        cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                        dr.Dispose();
                                                                                                                                        cmd.ExecuteNonQuery();

                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                        {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                            cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                            cmd.Parameters.AddWithValue("@rank", "7th Level Referral Bonus from " + UserId);
                                                                                                                                            cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                            cmd.Parameters.AddWithValue("@reason", "7th Level Referral Bonus from " + UserId);
                                                                                                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                            cmd.ExecuteNonQuery();
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                    dr.Dispose();
                                                                                                                                    //Level 8 Commissions
                                                                                                                                    string Level8ID = referralID;
                                                                                                                                    using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                    {
                                                                                                                                        cmd.Parameters.AddWithValue("@userid", Level8ID);
                                                                                                                                        using (dr = cmd.ExecuteReader())
                                                                                                                                        {
                                                                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                            {
                                                                                                                                                referralID = dr.GetValue(0).ToString();

                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                    cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                    cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                    cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                    cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                    cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                    dr.Dispose();
                                                                                                                                                    cmd.ExecuteNonQuery();

                                                                                                                                                    using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                    {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                        cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                        cmd.Parameters.AddWithValue("@rank", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                        cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                        cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                        cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                        cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                        cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                        cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                        cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                        cmd.Parameters.AddWithValue("@reason", "8th Level Referral Bonus from " + UserId);
                                                                                                                                                        cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                        cmd.ExecuteNonQuery();
                                                                                                                                                    }
                                                                                                                                                }

                                                                                                                                                dr.Dispose();
                                                                                                                                                //Level 6 Commissions
                                                                                                                                                string Level9ID = referralID;
                                                                                                                                                using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                {
                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", Level9ID);
                                                                                                                                                    using (dr = cmd.ExecuteReader())
                                                                                                                                                    {
                                                                                                                                                        if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                        {
                                                                                                                                                            referralID = dr.GetValue(0).ToString();

                                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                            {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                dr.Dispose();
                                                                                                                                                                cmd.ExecuteNonQuery();

                                                                                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@rank", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                    cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                    cmd.Parameters.AddWithValue("@reason", "9th Level Referral Bonus from " + UserId);
                                                                                                                                                                    cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                    cmd.ExecuteNonQuery();
                                                                                                                                                                }
                                                                                                                                                            }

                                                                                                                                                            dr.Dispose();
                                                                                                                                                            //Level 6 Commissions
                                                                                                                                                            string Level10ID = referralID;
                                                                                                                                                            using (cmd = new SqlCommand("Select refid from CRCitizensRegister where userid=@userid", con))
                                                                                                                                                            {
                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", Level10ID);
                                                                                                                                                                using (dr = cmd.ExecuteReader())
                                                                                                                                                                {
                                                                                                                                                                    if (dr.Read() && !dr.IsDBNull(0))
                                                                                                                                                                    {
                                                                                                                                                                        referralID = dr.GetValue(0).ToString();

                                                                                                                                                                        using (cmd = new SqlCommand("Insert into CRCitizensCommissionsRef(userid,username,refid,amount,datecreated,datecreateddd,datecreatedmm,datecreatedyy,status) values (@userid,@username,@refid,@amount,@datecreated,@datecreateddd,@datecreatedmm,@datecreatedyy,@status)", con))
                                                                                                                                                                        {//userid,refid,datecreated,datecreateddd,datecreatedmm,datecreatedyy
                                                                                                                                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@refid", referralID);//This is the ID that gets the #1100
                                                                                                                                                                            cmd.Parameters.AddWithValue("amount", 50);//1%
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreated", DateTime.Now.ToShortDateString());
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreateddd", DateTime.Now.Day);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedmm", DateTime.Now.Month);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@datecreatedyy", DateTime.Now.Year);
                                                                                                                                                                            cmd.Parameters.AddWithValue("@status", 0);
                                                                                                                                                                            dr.Dispose();
                                                                                                                                                                            cmd.ExecuteNonQuery();

                                                                                                                                                                            using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                                                                                            {   //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                                                                                                cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@username", referralname);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@rank", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@amountdue", 50);//1%
                                                                                                                                                                                cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                                                                                                cmd.Parameters.AddWithValue("@status", "0");
                                                                                                                                                                                cmd.Parameters.AddWithValue("@reason", "10th Level Referral Bonus from " + UserId);
                                                                                                                                                                                cmd.Parameters.AddWithValue("@programid", programID);
                                                                                                                                                                                cmd.ExecuteNonQuery();
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                    }
                                                                                                                                                                }
                                                                                                                                                            }
                                                                                                                                                        }
                                                                                                                                                    }
                                                                                                                                                }
                                                                                                                                            }
                                                                                                                                        }
                                                                                                                                    }
                                                                                                                                }
                                                                                                                            }
                                                                                                                        }
                                                                                                                    }
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion

                                                        #region 2. Add the codes for registration bonus
                                                        //do a loop selection till it get to 10 levels above that is 10 levels deep
                                                        using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                        { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.Parameters.AddWithValue("@username", useridname);
                                                            cmd.Parameters.AddWithValue("@rank", "Registration Bonus");
                                                            cmd.Parameters.AddWithValue("@amountdue", 1000);
                                                            cmd.Parameters.AddWithValue("@deductions", 0);
                                                            cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                            cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                            cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                            cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                            cmd.Parameters.AddWithValue("@status", "0");
                                                            cmd.Parameters.AddWithValue("@reason", "Registration Bonus");
                                                            cmd.Parameters.AddWithValue("@programid", programID);
                                                            cmd.ExecuteNonQuery();
                                                        }

                                                        #endregion

                                                        #region 3. Add the codes for CBPV(ConnectRecharge Points Value) & Corresponding Earnings - ReferrerID
                                                        //Earnings Codes for CBPVs

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(payassignedsn) from CRCitizensPlacementPay where payassignedsn=@assignedsn", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    double count = double.Parse(dr.GetValue(0).ToString());
                                                                    #region Counter > 1
                                                                    if (count > 1)
                                                                    {
                                                                        dr.Dispose();
                                                                        //use a loop to insert into earnings

                                                                        using (da = new SqlDataAdapter())
                                                                        {
                                                                            //, con
                                                                            DataSet ds = new DataSet();
                                                                            int ii = 0;
                                                                            string sql = null;
                                                                            sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                            using (cmd = new SqlCommand(sql, con))
                                                                            {
                                                                                da.SelectCommand = cmd;
                                                                                da.SelectCommand.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                                dr.Dispose();
                                                                                da.Fill(ds);
                                                                                for (ii = 0; ii <= ds.Tables[0].Rows.Count - 1; ii++)
                                                                                {
                                                                                    //countLine = 1;
                                                                                    string id = ds.Tables[0].Rows[ii].ItemArray[0].ToString();
                                                                                    string idname = ds.Tables[0].Rows[ii].ItemArray[1].ToString();
                                                                                    string paylevel = ds.Tables[0].Rows[ii].ItemArray[2].ToString();
                                                                                    string programid = ds.Tables[0].Rows[ii].ItemArray[3].ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                    #region Counter == 1
                                                                    else if (count == 1)
                                                                    {
                                                                        string sql = null;
                                                                        sql = "Select userid,useridname,paylevel,programid from CRCitizensPlacementPay where payassignedsn=@assignedsn";
                                                                        using (cmd = new SqlCommand(sql, con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@assignedsn", AssignedSN);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read())
                                                                                {
                                                                                    string id = dr.GetValue(0).ToString();
                                                                                    string idname = dr.GetValue(1).ToString();
                                                                                    string paylevel = dr.GetValue(2).ToString();
                                                                                    string programid = dr.GetValue(3).ToString();

                                                                                    if (paylevel == "100CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 100;
                                                                                        Award = "100CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "200CBPV")
                                                                                    {
                                                                                        idearnings = "1000";
                                                                                        CBPV = 200;
                                                                                        Award = "200CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "93.75CBPV")
                                                                                    {
                                                                                        idearnings = "500";
                                                                                        CBPV = 93.75;
                                                                                        Award = "93.75CBPV Bonus";
                                                                                    }
                                                                                    else if (paylevel == "3000CBPV")
                                                                                    {
                                                                                        idearnings = "50000";
                                                                                        CBPV = 400;
                                                                                        Award = "Smart Phone";
                                                                                    }
                                                                                    else if (paylevel == "6000CBPV")
                                                                                    {
                                                                                        idearnings = "80000";
                                                                                        CBPV = 6000;
                                                                                        Award = "Smart Tablet";
                                                                                    }
                                                                                    else if (paylevel == "12000CBPV")
                                                                                    {
                                                                                        idearnings = "500000";
                                                                                        CBPV = 12000;
                                                                                        Award = "Dubai Trip";
                                                                                    }
                                                                                    else if (paylevel == "25000CBPV")
                                                                                    {
                                                                                        idearnings = "4500000";
                                                                                        CBPV = 25000;
                                                                                        Award = "2nd Trip and Car Award";
                                                                                    }
                                                                                    else if (paylevel == "50000CBPV")
                                                                                    {
                                                                                        idearnings = "10500000";
                                                                                        CBPV = 50000;
                                                                                        Award = "3rd Trip and Jeep Award";
                                                                                    }
                                                                                    else if (paylevel == "100000CBPV")
                                                                                    {
                                                                                        idearnings = "15000000";
                                                                                        CBPV = 100000;
                                                                                        Award = "Land & House Fund";
                                                                                    }

                                                                                    using (cmd = new SqlCommand("Select userid from CRCitizensEarnings where userid=@userid and rank=@rank and programid=@programid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", id);
                                                                                        cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                        cmd.Parameters.AddWithValue("@programid", programid);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                //don't insert
                                                                                            }
                                                                                            else
                                                                                            {
                                                                                                dr.Dispose();
                                                                                                ///////////////////
                                                                                                // CHECK IF THIS USER IS AN AMBASSADOR/VENDOR TO KNOW IF CAN CROSS THE 12000CBPV 1ST DUBAI TRIP STAGE, 
                                                                                                // NOT HERE BUT WHEN PAYMENT IS TO BE MADE                                                                                                ///////////////////
                                                                                                //userid,useridname,assignedsn,paylevel,payamount,payassignedsn,datereg,dd,mm,yy,rank,programid
                                                                                                using (cmd = new SqlCommand("Insert into CRCitizensEarnings (userid,username,rank,amountdue,deductions,dd,mm,yy,date,status,reason,programid) values (@userid,@username,@rank,@amountdue,@deductions,@dd,@mm,@yy,@date,@status,@reason,@programid)", con))
                                                                                                { //rank,amountdue,deductions,balance,dd,mm,yy,date,status
                                                                                                    cmd.Parameters.AddWithValue("@userid", id);
                                                                                                    cmd.Parameters.AddWithValue("@username", idname);
                                                                                                    cmd.Parameters.AddWithValue("@rank", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("@amountdue", idearnings);
                                                                                                    cmd.Parameters.AddWithValue("@deductions", 0);
                                                                                                    cmd.Parameters.AddWithValue("@dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("@mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("@yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToShortDateString());
                                                                                                    cmd.Parameters.AddWithValue("@status", CBPV);//CBPV
                                                                                                    cmd.Parameters.AddWithValue("@reason", Award);
                                                                                                    cmd.Parameters.AddWithValue("@programid", programid);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }

                                                                                                //Insert into CBPV Counter
                                                                                                using (cmd = new SqlCommand("Insert into CRCBPVCounter(userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status) values (@userid,@programid,@cbpv,@dd,@mm,@yy,@totalcbpv,@currentlevel,@status)", con))
                                                                                                {//userid,programid,cbpv,dd,mm,yy,totalcbpv,currentlevel,status
                                                                                                    cmd.Parameters.AddWithValue("userid", id);
                                                                                                    cmd.Parameters.AddWithValue("programid", programid);
                                                                                                    cmd.Parameters.AddWithValue("cbpv", CBPV);
                                                                                                    cmd.Parameters.AddWithValue("dd", DateTime.Now.Day);
                                                                                                    cmd.Parameters.AddWithValue("mm", DateTime.Now.Month);
                                                                                                    cmd.Parameters.AddWithValue("yy", DateTime.Now.Year);
                                                                                                    cmd.Parameters.AddWithValue("totalcbpv", 0);
                                                                                                    cmd.Parameters.AddWithValue("currentlevel", paylevel);
                                                                                                    cmd.Parameters.AddWithValue("status", "0");
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    #endregion
                                                                }
                                                            }
                                                        }

                                                        #endregion



                                                        #region  4. Add APV Points
                                                        //Write codes to add APV points automatically
                                                        //Determine if eligible for APV points by checking if up to 10 citizens have been referred by them
                                                        dr.Dispose();
                                                        //Level 1
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 1);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 2
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 2);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 2);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 3
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 3);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 3);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 4);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 4);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //5
                                                        //Level 5
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 5);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 5);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //6
                                                        //Level 6
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 6);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 6);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //7
                                                        //Level 7
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 7);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //8
                                                        //Level 8
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 8);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 8);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //9
                                                        //Level 9
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 9);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 9);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }

                                                        //10
                                                        //Level 10
                                                        using (cmd = new SqlCommand("Select refid from crcitizensregister where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    referralID = dr.GetValue(0).ToString();
                                                                }
                                                            }
                                                        }

                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(userid) from crcitizensregister where refid=@refid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@refid", referralID);
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read())
                                                                {
                                                                    int count = int.Parse(dr.GetValue(0).ToString());
                                                                    if (count >= 10)
                                                                    {
                                                                        dr.Dispose();//userid,totalapv,usedapv,unusedapv,referrals
                                                                        using (cmd = new SqlCommand("Select totalapv,usedapv,unusedapv,referrals from crapvpoints where userid=@userid", con))
                                                                        {
                                                                            cmd.Parameters.AddWithValue("@userid", referralID);
                                                                            using (dr = cmd.ExecuteReader())
                                                                            {
                                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                                {
                                                                                    double newtotalapv = 0;
                                                                                    double newunusedapv = 0;
                                                                                    double totalapv = double.Parse(dr.GetValue(0).ToString());
                                                                                    double usedapv = double.Parse(dr.GetValue(1).ToString());
                                                                                    double unusedapv = double.Parse(dr.GetValue(2).ToString());
                                                                                    double referrals = double.Parse(dr.GetValue(3).ToString());
                                                                                    double newreferrals = referrals + 1;
                                                                                    APVLevel = 1;
                                                                                    if (newreferrals >= 2 && newreferrals <= 20)
                                                                                    {
                                                                                        newtotalapv = totalapv + 12.5;
                                                                                        newunusedapv = unusedapv + 12.5;
                                                                                    }
                                                                                    else if (newreferrals >= 21 && newreferrals <= 80)
                                                                                    {
                                                                                        newtotalapv = totalapv + 6.25;
                                                                                        newunusedapv = unusedapv + 6.25;
                                                                                    }
                                                                                    else if (newreferrals >= 81 && newreferrals <= 340)
                                                                                    {
                                                                                        newtotalapv = totalapv + 2.75;
                                                                                        newunusedapv = unusedapv + 2.75;
                                                                                    }
                                                                                    else if (newreferrals >= 341 && newreferrals <= 1300)
                                                                                    {
                                                                                        newtotalapv = totalapv + 1.25;
                                                                                        newunusedapv = unusedapv + 1.25;
                                                                                    }
                                                                                    else if (newreferrals >= 1301 && newreferrals <= 5400)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.5;
                                                                                        newunusedapv = unusedapv + 0.5;
                                                                                    }
                                                                                    else if (newreferrals >= 5401 && newreferrals <= 21000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.25;
                                                                                        newunusedapv = unusedapv + 0.25;
                                                                                    }
                                                                                    else if (newreferrals >= 21001 && newreferrals <= 87000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.15;
                                                                                        newunusedapv = unusedapv + 0.15;
                                                                                    }
                                                                                    else if (newreferrals >= 87001 && newreferrals <= 349000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.05;
                                                                                        newunusedapv = unusedapv + 0.05;
                                                                                    }
                                                                                    else if (newreferrals >= 349000 && newreferrals <= 400000)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.03;
                                                                                        newunusedapv = unusedapv + 0.03;
                                                                                    }
                                                                                    else if (newreferrals >= 400001)
                                                                                    {
                                                                                        newtotalapv = totalapv + 0.02;
                                                                                        newunusedapv = unusedapv + 0.02;
                                                                                    }

                                                                                    //Update APVPoints
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Update crapvpoints set totalapv=@totalapv,usedapv=@usedapv,unusedapv=@unusedapv,referrals=@referrals where userid=@userid", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@totalapv", newtotalapv);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", usedapv);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", newunusedapv);
                                                                                        cmd.Parameters.AddWithValue("@referrals", newreferrals);
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }

                                                                                    //Update APVReferrals 
                                                                                    //userid,levels,referrals
                                                                                    using (cmd = new SqlCommand("Select referals from crapvreferrals where userid=@userid and levels=@levels", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 10);
                                                                                        using (dr = cmd.ExecuteReader())
                                                                                        {
                                                                                            if (dr.Read() && !dr.IsDBNull(0))
                                                                                            {
                                                                                                int APVreferrals = int.Parse(dr.GetValue(0).ToString());
                                                                                                int newAPVreferrals = APVreferrals + 1;

                                                                                                dr.Dispose();
                                                                                                using (cmd = new SqlCommand("Update CRAPVReferrals set referrals=@referrals where where userid=@userid and levels=@levels", con))
                                                                                                {
                                                                                                    cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                                    cmd.Parameters.AddWithValue("@levels", 10);
                                                                                                    cmd.Parameters.AddWithValue("@referrals", newAPVreferrals);
                                                                                                    cmd.ExecuteNonQuery();
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    dr.Dispose();
                                                                                    using (cmd = new SqlCommand("Insert into crapvpoints(userid,totalapv,usedapv,unusedapv,referrals) values (@userid,@totalapv,@usedapv,@unusedapv,@referrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@totalapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@usedapv", 0);
                                                                                        cmd.Parameters.AddWithValue("@unusedapv", 12.5);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                    //userid,levels,referrals,totalreferrals
                                                                                    using (cmd = new SqlCommand("Insert into crapvreferrals(userid,levels,referrals,totalreferrals) values (@userid,@levels,@referrals,@totalreferrals)", con))
                                                                                    {
                                                                                        cmd.Parameters.AddWithValue("@userid", referralID);
                                                                                        cmd.Parameters.AddWithValue("@levels", 1);
                                                                                        cmd.Parameters.AddWithValue("@referrals", 1);
                                                                                        cmd.Parameters.AddWithValue("@totalreferrals", 1);
                                                                                        cmd.ExecuteNonQuery();
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                    else
                                                                    {

                                                                    }
                                                                }
                                                            }
                                                        }


                                                        #endregion


                                                        #region 5. Retained earnings/profits per registration
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Select count(registrations) from crprofitearnings", con))
                                                        {
                                                            using (dr = cmd.ExecuteReader())
                                                            {
                                                                if (dr.Read() && !dr.IsDBNull(0))
                                                                {
                                                                    int regCount = int.Parse(dr.GetValue(0).ToString());
                                                                    int NewregCount = regCount + 1;
                                                                    int NewAmount = NewregCount * 33;

                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Update crprofitearnings set registrations=@register,amount=@amount,total=@total", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@register", NewregCount);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", NewAmount);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    dr.Dispose();
                                                                    using (cmd = new SqlCommand("Insert into crprofitearnings(registrations,amount,total) values (@registrations,@amount,@total)", con))
                                                                    {
                                                                        cmd.Parameters.AddWithValue("@registrations", 1);
                                                                        cmd.Parameters.AddWithValue("@amount", 33);
                                                                        cmd.Parameters.AddWithValue("@total", 33);
                                                                        cmd.ExecuteNonQuery();

                                                                        ResponseMsg = "Success!";
                                                                    }
                                                                }
                                                            }
                                                        }
                                                        #endregion


                                                        #endregion




                                                        #endregion
                                                    }


                                                    #endregion
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    ResponseMsg = "Insufficient funds.";
                                }
                            }
                            else
                            {

                            }
                        }
                        //}
                        //scope.Complete();
                    }
                }
            }
            catch(Exception s)
            {
                string trap = s.InnerException.ToString();
            }
        }


        #region SendPaymentNotification-For Confirmation
        public void SendPaymentNotification()
        {
            //try
            //{
            using (con = new SqlConnection(conn))
            {
                con.Open();

                using (cmd = new SqlCommand("Select currency from CRCitizenregister where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read() && !dr.IsDBNull(0))
                        {
                            currency = dr.GetValue(0).ToString();
                        }
                    }
                }
                dr.Dispose();
                if (tellerno != "" && tellerno != "None")
                {
                    using (cmd = new SqlCommand("Select tellerno from crpaydetails where tellerno=@tellerno and bankname=@bankname", con))
                    {
                        cmd.Parameters.AddWithValue("@tellerno", tellerno);
                        cmd.Parameters.AddWithValue("@bankname", depositbank);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read() && !dr.IsDBNull(0))
                            {
                                ResponseMsg = "Teller No. is invalid or has been previously submitted.";
                            }
                            else
                            {
                                dr.Dispose();
                                using (cmd = new SqlCommand("Insert into crpaydetails(depositorname,email,amount,paymode,bankname,tellerno,remarks,paydate,confirmed,Userid,currency) values (@depositorname,@email,@amount,@paymode,@bankname,@tellerno,@remarks,@paydate,@confirmed,@userid,@currency)", con))
                                {
                                    cmd.Parameters.AddWithValue("@depositorname", depositorname);
                                    cmd.Parameters.AddWithValue("@email", depositoremail);
                                    cmd.Parameters.AddWithValue("@amount", depositoramount);
                                    cmd.Parameters.AddWithValue("@paymode", depositorpaymode);
                                    cmd.Parameters.AddWithValue("@bankname", depositbank);
                                    cmd.Parameters.AddWithValue("@tellerno", tellerno);
                                    cmd.Parameters.AddWithValue("@remarks", remarks);
                                    cmd.Parameters.AddWithValue("@paydate", depositorpaydate);
                                    cmd.Parameters.AddWithValue("@confirmed", "No");
                                    cmd.Parameters.AddWithValue("@userid", UserId);
                                    cmd.Parameters.AddWithValue("@currency", currency);
                                    cmd.ExecuteNonQuery();
                                    ResponseMsg = "Success!";
                                }
                            }
                        }
                    }
                }
                else
                {
                    dr.Dispose();
                    using (cmd = new SqlCommand("Insert into crpaydetails(depositorname,email,amount,paymode,bankname,tellerno,remarks,paydate,confirmed,Userid,currency) values (@depositorname,@email,@amount,@paymode,@bankname,@tellerno,@remarks,@paydate,@confirmed,@userid,@currency)", con))
                    {
                        cmd.Parameters.AddWithValue("@depositorname", depositorname);
                        cmd.Parameters.AddWithValue("@email", depositoremail);
                        cmd.Parameters.AddWithValue("@amount", depositoramount);
                        cmd.Parameters.AddWithValue("@paymode", depositorpaymode);
                        cmd.Parameters.AddWithValue("@bankname", depositbank);
                        cmd.Parameters.AddWithValue("@tellerno", tellerno);
                        cmd.Parameters.AddWithValue("@remarks", remarks);
                        cmd.Parameters.AddWithValue("@paydate", depositorpaydate);
                        cmd.Parameters.AddWithValue("@confirmed", "No");
                        cmd.Parameters.AddWithValue("@userid", UserId);
                        cmd.Parameters.AddWithValue("@currency", currency);
                        cmd.ExecuteNonQuery();
                        ResponseMsg = "Success!";
                    }
                }
            }
            //}
            //catch (Exception)
            //{                
            //    //throw;
            //}
        } 
        #endregion


        #region Withdrawals Requests
        public void LoadWithdrawals()
        {
            if(withdrawType == "Cash")
            {
                WithdrawalsCash();
            }
            else if (withdrawType == "Bonus")
            {
                //Check if due
            }
        }

        //Withdrawal Request 
        public void WithdrawalsCash()
        {
            using(con = new SqlConnection(conn))
            {
                con.Open();
                ////////////////////////////
                //Check this well and edit//
                ////////////////////////////
                using (cmd = new SqlCommand("Select SUM(amountdue) from CRCitizensEarnings where userid=@userid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    using(dr = cmd.ExecuteReader())
                    {
                        if(dr.Read())
                        {
                            int TotalEarnings = int.Parse(dr.GetValue(0).ToString());
                            using (cmd = new SqlCommand("Select totalwithdraw from CRCitizensEarningsWallet where userid=@userid", con))
                            {
                                cmd.Parameters.AddWithValue("@userid", UserId);
                                using (dr = cmd.ExecuteReader())
                                {
                                    if (dr.Read())
                                    {
                                        int TotalWithdraw = int.Parse(dr.GetValue(0).ToString());

                                        int NewBalance = TotalEarnings - TotalWithdraw;
                                        dr.Dispose();
                                        using(cmd = new SqlCommand("Update CRCitizensEarningsWallet set currentbalance=@currentbalance where userid=@userid", con))
                                        {
                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                            cmd.Parameters.AddWithValue("@currentbalance", NewBalance);
                                            cmd.ExecuteNonQuery();

                                            dr.Dispose();
                                            using (cmd = new SqlCommand("Select currentbalance,totalwithdraw from CRCitizensEarningsWallet where userid=@userid", con))
                                            {
                                                cmd.Parameters.AddWithValue("@userid", UserId);
                                                using (dr = cmd.ExecuteReader())
                                                {
                                                    if (dr.Read())
                                                    {
                                                        int getcurrentbalance = int.Parse(dr.GetValue(0).ToString());
                                                        int getNewBalance = getcurrentbalance - withdrawalAmount;

                                                        int totalWithdraw = int.Parse(dr.GetValue(1).ToString());
                                                        int newTotalwithdraw = totalWithdraw + withdrawalAmount;
                                                        //Effect the Update codes now
                                                        dr.Dispose();
                                                        using (cmd = new SqlCommand("Update CRCitizensEarningsWallet set totalwithdraw=@totalwithdraw,currentbalance=@currentbalance where userid=@userid", con))
                                                        {
                                                            cmd.Parameters.AddWithValue("@totalwithdraw", newTotalwithdraw);
                                                            cmd.Parameters.AddWithValue("@currentbalance", getNewBalance);
                                                            cmd.Parameters.AddWithValue("@userid", UserId);
                                                            cmd.ExecuteNonQuery();
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }                
            }
        }
        #endregion

        //Tracks every transaction executed via Connect Citizens in detailed records
        public void ConnectCitizensTrail()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Insert into CRCitizensTrail (Note,Date,UserId) values (@note,@date,@userid)", con))
                {
                    cmd.Parameters.AddWithValue("@note", note);
                    cmd.Parameters.AddWithValue("@date", DateTime.Now.ToString());
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    cmd.ExecuteNonQuery();
                }
            }
        }


        //Get Data Trail
        public DataTable ConnectCitizensGetDataTrail()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();

                if (MaxSN == 0)
                {
                    using (cmd = new SqlCommand("Select Max(SN) from CRCitizensTrail where userid=@userid", con))
                    {
                        cmd.Parameters.AddWithValue("@userid", username);
                        using (dr = cmd.ExecuteReader())
                        {
                            if (dr.Read())
                            {
                                int result = int.Parse(dr.GetValue(0).ToString());
                                if (result > 1)
                                {
                                    dr.Dispose();
                                    using (cmd = new SqlCommand("Select Max(SN),Min(SN) from CRCitizensTrail where userid=@userid", con))
                                    {
                                        cmd.Parameters.AddWithValue("@userid", username);
                                        using (dr = cmd.ExecuteReader())
                                        {
                                            if (dr.Read())
                                            {
                                                MaxSN = int.Parse(dr.GetValue(0).ToString());
                                                MinSN = int.Parse(dr.GetValue(0).ToString());
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    MaxSN = 1;
                                    MinSN = 1;
                                }
                            }
                        }
                    }
                }
                else
                {
                    if (next == 1)
                    {
                        MinSN = MaxSN + 1;
                        MaxSN = MaxSN + 20;
                    }
                    else if (previous == 1)
                    {
                        MaxSN = MaxSN - 19;
                    }
                }

                // dr.Dispose();
                using (cmd = new SqlCommand("Select Note as Transactions,Date as Tran_Date from CRCitizensTrail where userid=@userid and sn<=@Maxsn and sn>=@Minsn ORDER BY [SN] DESC", con))
                {
                    cmd.Parameters.AddWithValue("@userid", username);
                    if (MaxSN < 20)
                    {
                        cmd.Parameters.AddWithValue("@Maxsn", MaxSN);
                        cmd.Parameters.AddWithValue("@Minsn", MinSN);
                    }
                    else
                    {
                        cmd.Parameters.AddWithValue("@Maxsn", MaxSN);
                        cmd.Parameters.AddWithValue("@Minsn", MaxSN - 19);
                    }
                    using (SqlDataAdapter sda = new SqlDataAdapter())
                    {
                        cmd.Connection = con;
                        sda.SelectCommand = cmd;
                        using (dt = new DataTable())
                        {
                            sda.Fill(dt);
                            return dt;
                        }
                    }
                }
            }
        }

        //Connect Citizens PayStack Track
        public void CitizenRechargePayStackTrack()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select tranid from crcitizenpaystacktrack where userid=@userid and tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@userid", UserId);
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            ResponseMsg = "Transaction already exists.";
                        }
                        else
                        {
                            dr.Dispose();
                            using (cmd = new SqlCommand("Insert into crcitizenpaystacktrack (userid,tranid,amount,date,status) values (@userid,@tranid,@amount,@date,@status)", con))
                            {
                                cmd.Parameters.AddWithValue("@userid", UserId);
                                cmd.Parameters.AddWithValue("@tranid", tranid);
                                cmd.Parameters.AddWithValue("@amount", PayStackAmount);
                                cmd.Parameters.AddWithValue("@date", DateTime.Now.ToString());
                                cmd.Parameters.AddWithValue("@status", 0);
                                cmd.ExecuteNonQuery();
                                ResponseMsg = "Saved!";
                            }
                        }
                    }
                }
            }
        }

        //Check uniqueness of Transaction ID Generated for PayStack - ConnecCitizen
        public void CITIZENcheckTranID()
        {
            using (con = new SqlConnection(conn))
            {
                con.Open();
                using (cmd = new SqlCommand("Select tranid from cropenpaystacktrack where tranid=@tranid", con))
                {
                    cmd.Parameters.AddWithValue("@tranid", tranid);
                    using (dr = cmd.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            ResponseMsg = "1";
                        }
                        else
                        {
                            ResponseMsg = "0";
                        }
                    }
                }
            }
        }


        #endregion

        //Configure this to get the status of both VTU and Logical pin authentication
        #region RechargeStatus
        
        #endregion
    }
}